<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Quote Maker</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Quote Maker Debug Page</h1>
    
    <div class="debug-section">
        <h3>Test localStorage Quotes</h3>
        <button onclick="checkLocalStorage()">Check localStorage</button>
        <button onclick="addTestQuote()">Add Test Quote</button>
        <button onclick="clearLocalStorage()">Clear localStorage</button>
        <div id="localStorage-log" class="log"></div>
    </div>
    
    <div class="debug-section">
        <h3>Test DOM Elements</h3>
        <button onclick="checkDOMElements()">Check DOM Elements</button>
        <div id="dom-log" class="log"></div>
    </div>
    
    <div class="debug-section">
        <h3>Test Quote Maker Functions</h3>
        <button onclick="testQuoteMakerFunctions()">Test Functions</button>
        <div id="functions-log" class="log"></div>
    </div>
    
    <div class="debug-section">
        <h3>Navigation</h3>
        <a href="http://localhost:3000" target="_blank">Open Main App</a>
    </div>
    
    <script>
        function log(elementId, message) {
            const element = document.getElementById(elementId);
            element.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            console.log(message);
        }
        
        function checkLocalStorage() {
            const logElement = 'localStorage-log';
            document.getElementById(logElement).innerHTML = '';
            
            try {
                const quotes = localStorage.getItem('savedQuotes');
                log(logElement, 'Raw localStorage data: ' + quotes);
                
                if (quotes) {
                    const parsedQuotes = JSON.parse(quotes);
                    log(logElement, 'Parsed quotes count: ' + parsedQuotes.length);
                    parsedQuotes.forEach((quote, index) => {
                        log(logElement, `Quote ${index + 1}: ID=${quote.id}, Date=${quote.date}, Lines=${quote.lines ? quote.lines.length : 'N/A'}`);
                    });
                } else {
                    log(logElement, 'No quotes found in localStorage');
                }
            } catch (error) {
                log(logElement, 'Error checking localStorage: ' + error.message);
            }
        }
        
        function addTestQuote() {
            const logElement = 'localStorage-log';
            
            try {
                const testQuote = {
                    id: 'test-' + Date.now(),
                    date: new Date().toISOString(),
                    lines: [
                        { description: 'Test Product 1', quantity: 2, price: 100 },
                        { description: 'Test Product 2', quantity: 1, price: 50 }
                    ],
                    total: 250
                };
                
                let quotes = [];
                const existing = localStorage.getItem('savedQuotes');
                if (existing) {
                    quotes = JSON.parse(existing);
                }
                
                quotes.push(testQuote);
                localStorage.setItem('savedQuotes', JSON.stringify(quotes));
                
                log(logElement, 'Test quote added successfully');
                checkLocalStorage();
            } catch (error) {
                log(logElement, 'Error adding test quote: ' + error.message);
            }
        }
        
        function clearLocalStorage() {
            const logElement = 'localStorage-log';
            localStorage.removeItem('savedQuotes');
            log(logElement, 'localStorage cleared');
            checkLocalStorage();
        }
        
        function checkDOMElements() {
            const logElement = 'dom-log';
            document.getElementById(logElement).innerHTML = '';
            
            // Check if we're in an iframe or main window
            log(logElement, 'Window location: ' + window.location.href);
            log(logElement, 'Is in iframe: ' + (window !== window.top));
            
            // Try to access main app elements
            const elements = [
                'saved-quotes-container',
                'no-quotes-message',
                'quote-maker-module',
                'quote-maker-btn'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                log(logElement, `Element ${id}: ${element ? 'Found' : 'Not found'}`);
                if (element) {
                    log(logElement, `  - Display: ${getComputedStyle(element).display}`);
                    log(logElement, `  - Visibility: ${getComputedStyle(element).visibility}`);
                }
            });
        }
        
        function testQuoteMakerFunctions() {
            const logElement = 'functions-log';
            document.getElementById(logElement).innerHTML = '';
            
            // Check if functions exist in global scope
            const functions = [
                'renderSavedQuotesList',
                'initQuoteMaker',
                'showModule',
                'hideAllModules'
            ];
            
            functions.forEach(funcName => {
                const exists = typeof window[funcName] === 'function';
                log(logElement, `Function ${funcName}: ${exists ? 'Available' : 'Not available'}`);
            });
            
            // Try to call renderSavedQuotesList if it exists
            if (typeof window.renderSavedQuotesList === 'function') {
                try {
                    log(logElement, 'Attempting to call renderSavedQuotesList...');
                    window.renderSavedQuotesList();
                    log(logElement, 'renderSavedQuotesList called successfully');
                } catch (error) {
                    log(logElement, 'Error calling renderSavedQuotesList: ' + error.message);
                }
            }
        }
        
        // Auto-run checks on page load
        window.onload = function() {
            checkLocalStorage();
            checkDOMElements();
            testQuoteMakerFunctions();
        };
    </script>
</body>
</html>