<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price List Generator - Indian Natural Hair</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @media print {
            .no-print { display: none !important; }
        }
        .preview-canvas {
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .checkbox-group {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 12px;
            background: white;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        .checkbox-item:last-child {
            border-bottom: none;
        }
        .checkbox-item input[type="checkbox"] {
            margin-right: 8px;
            width: 16px;
            height: 16px;
            accent-color: #434662;
        }
        .checkbox-item label {
            color: #434662;
            font-size: 14px;
            cursor: pointer;
            flex: 1;
        }
        .modern-table {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .table-header {
            background: #434662;
            color: white;
            font-weight: 600;
        }
        .table-row:nth-child(even) {
            background: #f8f9fa;
        }
        .segment-header {
            background: #e5e9ea;
            color: #434662;
            font-weight: 700;
            padding: 12px;
            border-left: 4px solid #434662;
        }
    </style>
</head>
<body style="background-color: #e5e9ea; min-height: 100vh;">
    <div class="container mx-auto px-4 py-6">
        <div class="flex flex-col lg:flex-row gap-6">
            <!-- Sidebar Controls -->
            <div class="lg:w-1/3 bg-white rounded-lg shadow-lg p-6" style="background-color: #e5e9ea;">
                <h1 class="text-2xl font-bold mb-6" style="color: #434662;">Price List Generator</h1>
                
                <!-- Currency Selector -->
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2" style="color: #434662;">Currency</label>
                    <select id="currencySelect" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" style="background: white; color: #434662;">
                        <option value="INR">₹ INR</option>
                        <option value="USD">$ USD</option>
                        <option value="EUR">€ EUR</option>
                        <option value="GBP">£ GBP</option>
                        <option value="AUD">A$ AUD</option>
                        <option value="SAR">SAR</option>
                        <option value="NGN">₦ NAIRA</option>
                        <option value="AED">د.إ AED</option>
                    </select>
                </div>



                <!-- Category Dropdown and KG Controls -->
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2" style="color: #434662;">Category</label>
                    <div class="grid grid-cols-2 gap-2">
                        <select id="categorySelect" class="p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" style="background: white; color: #434662;">
                            <option value="">Select Category</option>
                        </select>
                        
                        <!-- KG Checkbox -->
                        <div id="kgCheckboxContainer" class="flex items-center justify-center hidden">
                            <label class="flex items-center">
                                <input type="checkbox" id="listInKg" class="mr-2 h-4 w-4 rounded" style="accent-color: #434662;">
                                <span class="text-sm font-medium" style="color: #434662;">List in KG</span>
                            </label>
                        </div>
                    </div>
                </div>
                


                <!-- Product Multi-Selection -->
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2" style="color: #434662;">Products</label>
                    <div id="productCheckboxes" class="checkbox-group">
                        <p style="color: #6b7280; font-size: 14px;">Select a category first</p>
                    </div>
                </div>

                <!-- Density Multi-Selection -->
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2" style="color: #434662;">Densities</label>
                    <div id="densityCheckboxes" class="checkbox-group">
                        <p style="color: #6b7280; font-size: 14px;">Select products first</p>
                    </div>
                </div>

                <!-- Color Multi-Selection -->
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2" style="color: #434662;">Colors</label>
                    <div id="colorCheckboxes" class="checkbox-group">
                        <p style="color: #6b7280; font-size: 14px;">Select densities first</p>
                    </div>
                </div>



                <!-- Selection Summary -->
                <div class="mb-6 p-4 rounded-md" style="background: white; border: 1px solid #d1d5db;">
                    <p class="text-sm font-medium" style="color: #434662;">Selected Combinations:</p>
                    <p id="selectionSummary" class="text-sm" style="color: #6b7280;">No selections made</p>
                </div>

                <!-- Select All Button -->
                <div class="mb-4">
                    <button id="selectAllBtn" class="w-full py-2 px-4 rounded-md transition-colors" style="background-color: #059669; color: white;" onmouseover="this.style.backgroundColor='#047857'" onmouseout="this.style.backgroundColor='#059669'" disabled>
                        Select All
                    </button>
                </div>

                <!-- Add Selected Button -->
                <div class="mb-4">
                    <button id="addToList" class="w-full py-3 px-4 rounded-md transition-colors" style="background-color: #434662; color: white;" onmouseover="this.style.backgroundColor='#363a52'" onmouseout="this.style.backgroundColor='#434662'" disabled>
                        Add Selected
                    </button>
                </div>

                <!-- Generate Button -->
                <div class="mb-4">
                    <button id="generateAllBtn" class="w-full py-2 px-4 rounded-md transition-colors" style="background-color: #7c3aed; color: white;" onmouseover="this.style.backgroundColor='#6d28d9'" onmouseout="this.style.backgroundColor='#7c3aed'" disabled>
                        Generate
                    </button>
                </div>

                <!-- Action Buttons -->
                <div class="grid grid-cols-2 gap-2">
                    <button id="downloadBtn" class="py-2 px-4 rounded-md transition-colors" style="background-color: #434662; color: white;" onmouseover="this.style.backgroundColor='#363a52'" onmouseout="this.style.backgroundColor='#434662'">
                        Download
                    </button>
                    <button id="shareBtn" class="py-2 px-4 rounded-md transition-colors" style="background-color: #434662; color: white;" onmouseover="this.style.backgroundColor='#363a52'" onmouseout="this.style.backgroundColor='#434662'">
                        Share
                    </button>
                </div>
            </div>

            <!-- Main Preview Panel -->
            <div class="lg:w-2/3 bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4" style="color: #434662;">Preview</h2>
                <div class="flex justify-center">
                    <canvas id="previewCanvas" class="preview-canvas max-w-full h-auto"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let productData = [];
        let exchangeRates = { INR: 1, USD: 0.012, EUR: 0.011, GBP: 0.0095, AUD: 0.018, SAR: 0.045, NGN: 5.5, AED: 0.044 };
        let selectedItems = [];
        let selectedProducts = [];
        let selectedDensities = [];
        let selectedColors = [];
        let currentCategory = '';

        
        // Currency symbols
        const currencySymbols = {
            INR: '₹',
            USD: '$',
            EUR: '€',
            GBP: '£',
            AUD: 'A$',
            SAR: 'SAR ',
            NGN: '₦',
            AED: 'د.إ '
        };

        // Load product data
        async function loadProductData() {
            try {
                const response = await fetch('./ProductDataJson280225.json');
                productData = await response.json();
                populateCategories();
                loadFromLocalStorage();
            } catch (error) {
                console.error('Error loading product data:', error);
                alert('Error loading product data. Please check if the JSON file is available.');
            }
        }

        // Populate categories dropdown
        function populateCategories() {
            const categorySelect = document.getElementById('categorySelect');
            const categories = [...new Set(productData.map(item => item.Catagory))];
            
            categorySelect.innerHTML = '<option value="">Select Category</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }

        // Populate products with checkboxes
        function populateProducts(category) {
            const container = document.getElementById('productCheckboxes');
            const products = [...new Set(productData.filter(item => item.Catagory === category).map(item => item.Product))];
            
            container.innerHTML = '';
            products.forEach(product => {
                const div = document.createElement('div');
                div.className = 'checkbox-item';
                div.innerHTML = `
                    <input type="checkbox" id="product_${product}" value="${product}" onchange="updateProductSelection()">
                    <label for="product_${product}">${product}</label>
                `;
                container.appendChild(div);
            });
        }

        // Populate densities with checkboxes
        function populateDensities() {
            const container = document.getElementById('densityCheckboxes');
            if (selectedProducts.length === 0) {
                container.innerHTML = '<p style="color: #6b7280; font-size: 14px;">Select products first</p>';
                return;
            }
            
            const densities = [...new Set(productData.filter(item => 
                item.Catagory === currentCategory && selectedProducts.includes(item.Product)
            ).map(item => item.Density))];
            
            container.innerHTML = '';
            densities.forEach(density => {
                const div = document.createElement('div');
                div.className = 'checkbox-item';
                div.innerHTML = `
                    <input type="checkbox" id="density_${density}" value="${density}" onchange="updateDensitySelection()">
                    <label for="density_${density}">${density}</label>
                `;
                container.appendChild(div);
            });
        }

        // Populate colors with checkboxes
        function populateColors() {
            const container = document.getElementById('colorCheckboxes');
            if (selectedDensities.length === 0) {
                container.innerHTML = '<p style="color: #6b7280; font-size: 14px;">Select densities first</p>';
                return;
            }
            
            const colors = [...new Set(productData.filter(item => 
                item.Catagory === currentCategory && 
                selectedProducts.includes(item.Product) && 
                selectedDensities.includes(item.Density)
            ).map(item => item.Colors))];
            
            container.innerHTML = '';
            colors.forEach(color => {
                const div = document.createElement('div');
                div.className = 'checkbox-item';
                div.innerHTML = `
                    <input type="checkbox" id="color_${color}" value="${color}" onchange="updateColorSelection()">
                    <label for="color_${color}">${color}</label>
                `;
                container.appendChild(div);
            });
        }

        // Update product selection
        function updateProductSelection() {
            selectedProducts = [];
            document.querySelectorAll('#productCheckboxes input[type="checkbox"]:checked').forEach(cb => {
                selectedProducts.push(cb.value);
            });
            selectedDensities = [];
            selectedColors = [];
            populateDensities();
            populateColors();
            updateSelectionSummary();
            updateRealTimePricing();

        }

        // Update density selection
        function updateDensitySelection() {
            selectedDensities = [];
            document.querySelectorAll('#densityCheckboxes input[type="checkbox"]:checked').forEach(cb => {
                selectedDensities.push(cb.value);
            });
            selectedColors = [];
            populateColors();
            updateSelectionSummary();
            updateRealTimePricing();
        }

        // Update color selection
        function updateColorSelection() {
            selectedColors = [];
            document.querySelectorAll('#colorCheckboxes input[type="checkbox"]:checked').forEach(cb => {
                selectedColors.push(cb.value);
            });
            updateSelectionSummary();
            updateRealTimePricing();
        }

        // Update selection summary
        function updateSelectionSummary() {
            const summary = document.getElementById('selectionSummary');
            const addButton = document.getElementById('addToList');
            const selectAllButton = document.getElementById('selectAllBtn');
            const generateAllButton = document.getElementById('generateAllBtn');
            
            if (selectedProducts.length === 0) {
                summary.textContent = 'No selections made';
                addButton.disabled = true;
                selectAllButton.disabled = true;
                generateAllButton.disabled = !currentCategory;
                return;
            }
            
            const combinations = selectedProducts.length * Math.max(1, selectedDensities.length) * Math.max(1, selectedColors.length);
            summary.innerHTML = `
                <strong>Products:</strong> ${selectedProducts.length}<br>
                <strong>Densities:</strong> ${selectedDensities.length || 'All'}<br>
                <strong>Colors:</strong> ${selectedColors.length || 'All'}<br>
                <strong>Total Combinations:</strong> ${combinations}
            `;
            
            addButton.disabled = selectedProducts.length === 0 || selectedDensities.length === 0 || selectedColors.length === 0;
            selectAllButton.disabled = !currentCategory;
            generateAllButton.disabled = !currentCategory;
        }

        // Select All / Clear All toggle functionality
        function toggleSelectAll() {
            const selectAllBtn = document.getElementById('selectAllBtn');
            const isSelectingAll = selectAllBtn.textContent.trim() === 'Select All';
            
            if (isSelectingAll) {
                selectAllItems();
                selectAllBtn.textContent = 'Clear All';
                selectAllBtn.style.backgroundColor = '#dc2626';
                selectAllBtn.onmouseover = function() { this.style.backgroundColor = '#b91c1c'; };
                selectAllBtn.onmouseout = function() { this.style.backgroundColor = '#dc2626'; };
            } else {
                clearAllSelections();
                selectAllBtn.textContent = 'Select All';
                selectAllBtn.style.backgroundColor = '#059669';
                selectAllBtn.onmouseover = function() { this.style.backgroundColor = '#047857'; };
                selectAllBtn.onmouseout = function() { this.style.backgroundColor = '#059669'; };
            }
        }
        
        // Select all available items for current category
        function selectAllItems() {
            if (!currentCategory) return;
            
            // Get all available options for current category
            const categoryData = productData.filter(item => item.Catagory === currentCategory);
            const allProducts = [...new Set(categoryData.map(item => item.Product))];
            const allDensities = [...new Set(categoryData.map(item => item.Density))];
            const allColors = [...new Set(categoryData.map(item => item.Colors))];
            
            // Select all products
            document.querySelectorAll('#productCheckboxes input[type="checkbox"]').forEach(cb => {
                cb.checked = true;
            });
            selectedProducts = allProducts;
            
            // Select all densities
            document.querySelectorAll('#densityCheckboxes input[type="checkbox"]').forEach(cb => {
                cb.checked = true;
            });
            selectedDensities = allDensities;
            
            // Select all colors
            document.querySelectorAll('#colorCheckboxes input[type="checkbox"]').forEach(cb => {
                cb.checked = true;
            });
            selectedColors = allColors;
            
            updateSelectionSummary();
            updateRealTimePricing();
        }
        
        // Clear all selections
        function clearAllSelections() {
            // Clear all checkboxes
            document.querySelectorAll('#productCheckboxes input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            document.querySelectorAll('#densityCheckboxes input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            document.querySelectorAll('#colorCheckboxes input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            
            // Clear arrays
            selectedProducts = [];
            selectedDensities = [];
            selectedColors = [];
            
            // Repopulate densities to reset the cascade
            populateDensities();
            
            updateSelectionSummary();
            updateRealTimePricing();
        }

        // Generate all possible combinations for the selected category
        function generateAllCombinations() {
            if (!currentCategory) {
                alert('Please select a category first.');
                return;
            }
            
            const currency = document.getElementById('currencySelect').value;
            const symbol = currencySymbols[currency];
            
            // Get all unique combinations for the category
            const categoryData = productData.filter(item => item.Catagory === currentCategory);
            const allProducts = [...new Set(categoryData.map(item => item.Product))];
            const allDensities = [...new Set(categoryData.map(item => item.Density))];
            const allColors = [...new Set(categoryData.map(item => item.Colors))];
            
            const totalCombinations = allProducts.length * allDensities.length * allColors.length;
            
            if (totalCombinations > 50) {
                const proceed = confirm(`This will generate ${totalCombinations} ${currentCategory === 'DIY' ? 'segments in 1 file' : 'separate files'}. This may take some time. Continue?`);
                if (!proceed) return;
            }
            
            // Collect all segments
            const allSegments = [];
            allProducts.forEach(product => {
                allDensities.forEach(density => {
                    allColors.forEach(color => {
                        const matchingItems = categoryData.filter(item => 
                            item.Product === product &&
                            item.Density === density &&
                            item.Colors === color
                        );
                        
                        if (matchingItems.length > 0) {
                            const segment = {
                                product,
                                density,
                                color,
                                items: matchingItems.map(item => {
                                    const isKgMode = item['Can Be Sold in KG?'] === 'y' || item['Can Be Sold in KG?'] === 'Y';
                                    let price = parseFloat(item.Rate) * exchangeRates[currency];
                                    if (isKgMode) price *= 10;
                                    
                                    return {
                                        category: currentCategory,
                                        product,
                                        density,
                                        color,
                                        length: item.Length,
                                        price,
                                        currency,
                                        isKgMode,
                                        originalItem: item
                                    };
                                })
                            };
                            allSegments.push(segment);
                        }
                    });
                });
            });
            
            // Generate comprehensive PDF with all segments
            generateComprehensivePDF(currency, symbol);
            
            alert(`Successfully generated comprehensive PDF with ${allSegments.length} product combinations!`);
        }

        // Real-time currency conversion and pricing
        function updateRealTimePricing() {
            // This function will be called whenever selections change
            // It updates pricing in real-time as requested
            if (selectedProducts.length > 0 && selectedDensities.length > 0 && selectedColors.length > 0) {
                generatePreview();
            }
        }

        // Check if category can be sold in KG
        function checkKgAvailability(category) {
            const kgCheckboxContainer = document.getElementById('kgCheckboxContainer');
            const hasKgItems = productData.some(item => 
                item.Catagory === category && 
                (item['Can Be Sold in KG?'] === 'y' || item['Can Be Sold in KG?'] === 'Y')
            );
            
            if (hasKgItems) {
                kgCheckboxContainer.classList.remove('hidden');
            } else {
                kgCheckboxContainer.classList.add('hidden');
                document.getElementById('listInKg').checked = false;
            }
        }

        // Get all combinations for selected items
        function getAllCombinations() {
            const combinations = [];
            const currency = document.getElementById('currencySelect').value;
            const isKgMode = document.getElementById('listInKg').checked;
            
            selectedProducts.forEach(product => {
                selectedDensities.forEach(density => {
                    selectedColors.forEach(color => {
                        const matchingItems = productData.filter(item => 
                            item.Catagory === currentCategory &&
                            item.Product === product &&
                            item.Density === density &&
                            item.Colors === color
                        );
                        
                        if (matchingItems.length > 0) {
                            combinations.push({
                                product,
                                density,
                                color,
                                items: matchingItems
                            });
                        }
                    });
                });
            });
            
            return combinations;
        }

        // Add selected combinations to list
        function addToList() {
            const combinations = getAllCombinations();
            const currency = document.getElementById('currencySelect').value;
            const isKgMode = document.getElementById('listInKg').checked;
            
            combinations.forEach(combo => {
                combo.items.forEach(item => {
                    let price = parseFloat(item.Rate) * exchangeRates[currency];
                    if (isKgMode && (item['Can Be Sold in KG?'] === 'y' || item['Can Be Sold in KG?'] === 'Y')) {
                        price *= 10;
                    }
                    
                    const listItem = {
                        category: currentCategory,
                        product: combo.product,
                        density: combo.density,
                        color: combo.color,
                        length: item.Length,
                        price: price,
                        currency: currency,
                        isKgMode: isKgMode && (item['Can Be Sold in KG?'] === 'y' || item['Can Be Sold in KG?'] === 'Y'),
                        originalItem: item
                    };
                    
                    // Check for duplicates
                    const exists = selectedItems.some(existing => 
                        existing.category === listItem.category &&
                        existing.product === listItem.product &&
                        existing.density === listItem.density &&
                        existing.color === listItem.color &&
                        existing.length === listItem.length &&
                        existing.isKgMode === listItem.isKgMode
                    );
                    
                    if (!exists) {
                        selectedItems.push(listItem);
                    }
                });
            });
            
            saveToLocalStorage();
            generatePreview();
        }

        // Clear all selections


        // Generate modern Canvas preview with separate title section and clean table
        function generatePreview() {
            const canvas = document.getElementById('previewCanvas');
            const ctx = canvas.getContext('2d');
            const currency = document.getElementById('currencySelect').value;
            const symbol = currencySymbols[currency];
            
            // Set high DPI for crisp rendering
            const dpr = window.devicePixelRatio || 1;
            canvas.width = 800 * dpr;
            canvas.height = 1000 * dpr;
            canvas.style.width = '800px';
            canvas.style.height = '1000px';
            ctx.scale(dpr, dpr);
            
            // Enable image smoothing for high quality
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            
            // Clear canvas with background color
            ctx.fillStyle = '#e5e9ea';
            ctx.fillRect(0, 0, 800, 1000);
            
            // Draw title section with logo and images
            drawTitleSection(ctx, currency);
            
            // Draw modern table with segments
            drawModernTable(ctx, symbol);
        }

        // Draw title section with high-quality logo and images
        function drawTitleSection(ctx, currency) {
            // Title section background
            ctx.fillStyle = 'white';
            ctx.fillRect(20, 20, 760, 120);
            
            // Add shadow
            ctx.shadowColor = 'rgba(0, 0, 0, 0.1)';
            ctx.shadowBlur = 10;
            ctx.shadowOffsetY = 4;
            
            // Load and draw logo
            const logo = new Image();
            logo.onload = function() {
                ctx.drawImage(logo, 40, 40, 120, 80);
            };
            logo.src = './logo.png';
            
            // Load and draw madewithbadge
            const badge = new Image();
            badge.onload = function() {
                ctx.drawImage(badge, 650, 50, 100, 60);
            };
            badge.src = './madewithbadge.png';
            
            // Title text
            ctx.fillStyle = '#434662';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`Price List (${currency})`, 400, 90);
            
            // Reset shadow
            ctx.shadowColor = 'transparent';
        }

        // Draw modern table with segments and rounded edges
        function drawModernTable(ctx, symbol) {
            if (selectedItems.length === 0) {
                ctx.fillStyle = '#434662';
                ctx.font = '18px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No items selected', 400, 400);
                return;
            }

            let yPosition = 160;
            const segments = getAllCombinations();
            
            segments.forEach((segment, index) => {
                // Draw segment header with rounded corners
                ctx.fillStyle = 'white';
                roundRect(ctx, 20, yPosition, 760, 40, 8);
                ctx.fill();
                
                // Segment title
                ctx.fillStyle = '#434662';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'left';
                ctx.fillText(`${segment.product} - ${segment.density} - ${segment.color}`, 40, yPosition + 25);
                
                yPosition += 50;
                
                // Draw table for this segment
                const segmentItems = selectedItems.filter(item => 
                    item.product === segment.product &&
                    item.density === segment.density &&
                    item.color === segment.color
                );
                
                // Table background
                ctx.fillStyle = 'white';
                roundRect(ctx, 20, yPosition, 760, segmentItems.length * 30 + 40, 8);
                ctx.fill();
                
                // Table header
                ctx.fillStyle = '#f8f9fa';
                roundRect(ctx, 20, yPosition, 760, 30, 8);
                ctx.fill();
                
                ctx.fillStyle = '#434662';
                ctx.font = 'bold 14px Arial';
                ctx.fillText('Length', 40, yPosition + 20);
                ctx.fillText('Price', 700, yPosition + 20);
                
                yPosition += 30;
                
                // Table rows
                segmentItems.forEach((item, rowIndex) => {
                    if (rowIndex % 2 === 1) {
                        ctx.fillStyle = '#f8f9fa';
                        ctx.fillRect(20, yPosition, 760, 30);
                    }
                    
                    ctx.fillStyle = '#434662';
                    ctx.font = '14px Arial';
                    ctx.fillText(`${item.length}"`, 40, yPosition + 20);
                    ctx.fillText(`${symbol}${item.price.toFixed(2)}`, 700, yPosition + 20);
                    
                    yPosition += 30;
                });
                
                yPosition += 20; // Space between segments
            });
        }

        // Helper function to draw rounded rectangles
        function roundRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
        }

        // Save to local storage
        function saveToLocalStorage() {
            localStorage.setItem('selectedItems', JSON.stringify(selectedItems));
        }

        // Load from local storage
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('selectedItems');
            if (saved) {
                selectedItems = JSON.parse(saved);
            }
        }



        // Download PDF function - generates separate PDF files for each segment
        function downloadPDF() {
            const currency = document.getElementById('currencySelect').value;
            const symbol = currencySymbols[currency];
            
            // Generate comprehensive PDF with all available price lists
            generateComprehensivePDF(currency, symbol);
        }
        
        // Generate a single comprehensive PDF with all price list sections
        function generateComprehensivePDF(currency, symbol) {
            // Get all unique categories from product data
            const categories = [...new Set(productData.map(item => item.Catagory))];
            
            // Create segments for all product combinations across all categories
            const allSegments = [];
            
            categories.forEach(category => {
                const categoryData = productData.filter(item => item.Catagory === category);
                const products = [...new Set(categoryData.map(item => item.Product))];
                const densities = [...new Set(categoryData.map(item => item.Density))];
                const colors = [...new Set(categoryData.map(item => item.Colors))];
                
                // Create segments for each product-density-color combination
                products.forEach(product => {
                    densities.forEach(density => {
                        colors.forEach(color => {
                            const items = categoryData.filter(item => 
                                item.Product === product && 
                                item.Density === density && 
                                item.Colors === color
                            );
                            
                            if (items.length > 0) {
                                allSegments.push({
                                    category: category,
                                    product: product,
                                    density: density,
                                    color: color,
                                    items: items.map(item => ({
                                        ...item,
                                        price: parseFloat(item.Price) * (exchangeRates[currency] || 1)
                                    }))
                                });
                            }
                        });
                    });
                });
            });
            
            // Generate the comprehensive PDF
            generateComprehensivePDFCanvas(allSegments, currency, symbol);
        }
        
        // Generate comprehensive PDF canvas with all price list sections
        function generateComprehensivePDFCanvas(allSegments, currency, symbol) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Calculate total height needed for all segments
            const headerHeight = 150;
            const segmentHeaderHeight = 80;
            const itemHeight = 25;
            const segmentPadding = 40;
            const footerHeight = 100;
            
            let totalHeight = headerHeight + footerHeight;
            
            // Group segments by category for better organization
            const segmentsByCategory = {};
            allSegments.forEach(segment => {
                if (!segmentsByCategory[segment.category]) {
                    segmentsByCategory[segment.category] = [];
                }
                segmentsByCategory[segment.category].push(segment);
            });
            
            // Calculate height for each category section
            Object.keys(segmentsByCategory).forEach(category => {
                totalHeight += 60; // Category header
                segmentsByCategory[category].forEach(segment => {
                    totalHeight += segmentHeaderHeight + (segment.items.length * itemHeight) + segmentPadding;
                });
            });
            
            // Set high DPI for crisp rendering
            const dpr = window.devicePixelRatio || 1;
            canvas.width = 800 * dpr;
            canvas.height = Math.max(1000, totalHeight) * dpr;
            ctx.scale(dpr, dpr);
            
            // Enable image smoothing for high quality
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            
            // Clear canvas with background color
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, 800, Math.max(1000, totalHeight));
            
            // Draw main header
            drawComprehensiveHeader(ctx, currency, symbol, Object.keys(segmentsByCategory).length);
            
            // Draw all category sections
            let currentY = headerHeight;
            Object.keys(segmentsByCategory).forEach((category, categoryIndex) => {
                currentY = drawCategorySection(ctx, category, segmentsByCategory[category], symbol, currentY, categoryIndex + 1);
            });
            
            // Draw footer
            drawComprehensiveFooter(ctx, currentY);
            
            // Convert canvas to PDF using jsPDF
            const imgData = canvas.toDataURL('image/jpeg', 0.95);
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            const imgWidth = 210; // A4 width in mm
            const pageHeight = 295; // A4 height in mm
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
            let heightLeft = imgHeight;
            
            let position = 0;
            
            // Add first page
            pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
            
            // Add additional pages if needed
            while (heightLeft >= 0) {
                position = heightLeft - imgHeight;
                pdf.addPage();
                pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
            }
            
            // Download the PDF
            const filename = `Complete-Price-List-${currency}.pdf`;
            pdf.save(filename.replace(/[^a-zA-Z0-9.-]/g, '_'));
            
            alert(`Successfully generated comprehensive price list with ${allSegments.length} product combinations across ${Object.keys(segmentsByCategory).length} categories!`);
        }
        
        // Draw comprehensive header
        function drawComprehensiveHeader(ctx, currency, symbol, categoryCount) {
            // Background gradient
            const gradient = ctx.createLinearGradient(0, 0, 800, 150);
            gradient.addColorStop(0, '#1e40af');
            gradient.addColorStop(1, '#3b82f6');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 800, 150);
            
            // Title
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 32px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Complete Price List', 400, 50);
            
            // Subtitle
            ctx.font = '18px Arial';
            ctx.fillText(`${categoryCount} Categories • All Products • Currency: ${currency}`, 400, 80);
            
            // Date
            ctx.font = '14px Arial';
            ctx.fillText(`Generated: ${new Date().toLocaleDateString()}`, 400, 110);
            
            // Border
            ctx.strokeStyle = '#1e40af';
            ctx.lineWidth = 3;
            ctx.strokeRect(0, 0, 800, 150);
        }
        
        // Draw category section
        function drawCategorySection(ctx, category, segments, symbol, startY, categoryIndex) {
            let currentY = startY;
            
            // Category header
            ctx.fillStyle = '#f3f4f6';
            ctx.fillRect(20, currentY, 760, 50);
            
            ctx.fillStyle = '#1f2937';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`${categoryIndex}. ${category}`, 40, currentY + 32);
            
            // Category border
            ctx.strokeStyle = '#d1d5db';
            ctx.lineWidth = 2;
            ctx.strokeRect(20, currentY, 760, 50);
            
            currentY += 60;
            
            // Draw each segment in this category
            segments.forEach((segment, segmentIndex) => {
                currentY = drawSegmentInCategory(ctx, segment, symbol, currentY, segmentIndex + 1);
            });
            
            return currentY + 20; // Add spacing between categories
        }
        
        // Draw individual segment within category
        function drawSegmentInCategory(ctx, segment, symbol, startY, segmentIndex) {
            let currentY = startY;
            
            // Segment header
            ctx.fillStyle = '#e5e7eb';
            ctx.fillRect(40, currentY, 720, 40);
            
            ctx.fillStyle = '#374151';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`${segment.product} - ${segment.density} - ${segment.color}`, 60, currentY + 25);
            
            // Segment border
            ctx.strokeStyle = '#9ca3af';
            ctx.lineWidth = 1;
            ctx.strokeRect(40, currentY, 720, 40);
            
            currentY += 50;
            
            // Table headers
            ctx.fillStyle = '#f9fafb';
            ctx.fillRect(60, currentY, 680, 30);
            
            ctx.fillStyle = '#111827';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Size', 120, currentY + 20);
            ctx.fillText('Thickness', 240, currentY + 20);
            ctx.fillText('Weight', 360, currentY + 20);
            ctx.fillText('Price (' + symbol + ')', 480, currentY + 20);
            ctx.fillText('MOQ', 600, currentY + 20);
            ctx.fillText('Lead Time', 680, currentY + 20);
            
            // Table header border
            ctx.strokeStyle = '#d1d5db';
            ctx.lineWidth = 1;
            ctx.strokeRect(60, currentY, 680, 30);
            
            currentY += 30;
            
            // Table rows
            segment.items.forEach((item, itemIndex) => {
                const rowY = currentY + (itemIndex * 25);
                
                // Alternate row colors
                ctx.fillStyle = itemIndex % 2 === 0 ? '#ffffff' : '#f9fafb';
                ctx.fillRect(60, rowY, 680, 25);
                
                // Item data
                ctx.fillStyle = '#374151';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(item.Size || '-', 120, rowY + 16);
                ctx.fillText(item.Thickness || '-', 240, rowY + 16);
                ctx.fillText(item.Weight || '-', 360, rowY + 16);
                ctx.fillText(item.price ? item.price.toFixed(2) : '-', 480, rowY + 16);
                ctx.fillText(item.MOQ || '-', 600, rowY + 16);
                ctx.fillText(item['Lead time'] || '-', 680, rowY + 16);
                
                // Row border
                ctx.strokeStyle = '#e5e7eb';
                ctx.lineWidth = 0.5;
                ctx.strokeRect(60, rowY, 680, 25);
            });
            
            return currentY + (segment.items.length * 25) + 20;
        }
        
        // Draw comprehensive footer
        function drawComprehensiveFooter(ctx, startY) {
            // Footer background
            ctx.fillStyle = '#f3f4f6';
            ctx.fillRect(0, startY, 800, 80);
            
            // Footer text
            ctx.fillStyle = '#6b7280';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('This comprehensive price list includes all available products across all categories.', 400, startY + 25);
            ctx.fillText('Prices are subject to change. Please contact us for the most current pricing.', 400, startY + 45);
            ctx.fillText('Generated by Price List Generator', 400, startY + 65);
            
            // Footer border
            ctx.strokeStyle = '#d1d5db';
            ctx.lineWidth = 1;
            ctx.strokeRect(0, startY, 800, 80);
        }
        
        // Generate enhanced segment file with new header format and category images

        

        

        

        



        


        // Generate PDF for individual segment
        function generateSegmentPDF(segment, currency, symbol, fileNumber, totalFiles) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(20);
            doc.setTextColor(67, 70, 98);
            doc.text('Indian Natural Hair', 105, 20, { align: 'center' });
            
            // Add segment info
            doc.setFontSize(16);
            const unit = segment.items[0]?.isKgMode ? 'KG' : 'Pieces';
            doc.text(`${segment.product} - ${segment.density} - ${segment.color} (${unit})`, 105, 35, { align: 'center' });
            
            // Add currency info
            doc.setFontSize(12);
            doc.text(`Currency: ${currency} | File ${fileNumber} of ${totalFiles}`, 105, 45, { align: 'center' });
            
            // Table headers
            doc.setFontSize(10);
            doc.setTextColor(255, 255, 255);
            doc.setFillColor(67, 70, 98);
            doc.rect(20, 55, 170, 8, 'F');
            doc.text('Length', 25, 61);
            doc.text(`Price (${symbol})`, 70, 61);
            doc.text('Product', 110, 61);
            doc.text('Density', 150, 61);
            doc.text('Color', 175, 61);
            
            // Table rows
            doc.setTextColor(67, 70, 98);
            let yPos = 70;
            segment.items.forEach((item, index) => {
                if (index % 2 === 0) {
                    doc.setFillColor(248, 249, 250);
                    doc.rect(20, yPos - 5, 170, 8, 'F');
                }
                
                doc.text(item.length, 25, yPos);
                doc.text(item.price.toFixed(2), 70, yPos);
                doc.text(item.product.substring(0, 15), 110, yPos);
                doc.text(item.density.substring(0, 10), 150, yPos);
                doc.text(item.color.substring(0, 8), 175, yPos);
                yPos += 8;
            });
            
            // Footer
            doc.setFontSize(8);
            doc.text('Contact: info@indiannaturalhair.com', 105, 280, { align: 'center' });
            
            // Download
            const filename = `${segment.product}-${segment.density}-${segment.color}-${currency}-${unit}.pdf`;
            doc.save(filename.replace(/[^a-zA-Z0-9.-]/g, '_'));
            
            // Show progress
            if (fileNumber === totalFiles) {
                setTimeout(() => {
                    alert(`Successfully generated ${totalFiles} PDF price list files!`);
                }, 500);
            }
        }

        // Share function - now generates PDF
        function shareList() {
            if (selectedItems.length === 0) {
                alert('No items selected. Please add items to your list first.');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const currency = document.getElementById('currencySelect').value;
            const symbol = currencySymbols[currency];
            
            // Add title
            doc.setFontSize(20);
            doc.setTextColor(67, 70, 98);
            doc.text('Indian Natural Hair - Price List', 105, 20, { align: 'center' });
            
            // Add currency info
            doc.setFontSize(12);
            doc.text(`Currency: ${currency}`, 105, 35, { align: 'center' });
            
            // Group items by segments
            const segments = [];
            selectedItems.forEach(item => {
                const segmentKey = `${item.product}-${item.density}-${item.color}`;
                let segment = segments.find(s => s.key === segmentKey);
                if (!segment) {
                    segment = {
                        key: segmentKey,
                        product: item.product,
                        density: item.density,
                        color: item.color,
                        items: []
                    };
                    segments.push(segment);
                }
                segment.items.push(item);
            });
            
            let yPos = 50;
            segments.forEach((segment, segIndex) => {
                // Segment header
                doc.setFontSize(14);
                doc.setTextColor(67, 70, 98);
                const unit = segment.items[0]?.isKgMode ? 'KG' : 'Pieces';
                doc.text(`${segment.product} - ${segment.density} - ${segment.color} (${unit})`, 20, yPos);
                yPos += 10;
                
                // Table headers
                doc.setFontSize(10);
                doc.setTextColor(255, 255, 255);
                doc.setFillColor(67, 70, 98);
                doc.rect(20, yPos - 5, 170, 8, 'F');
                doc.text('Length', 25, yPos);
                doc.text(`Price (${symbol})`, 70, yPos);
                doc.text('Product', 110, yPos);
                doc.text('Density', 150, yPos);
                doc.text('Color', 175, yPos);
                yPos += 10;
                
                // Table rows
                doc.setTextColor(67, 70, 98);
                segment.items.forEach((item, index) => {
                    if (index % 2 === 0) {
                        doc.setFillColor(248, 249, 250);
                        doc.rect(20, yPos - 5, 170, 8, 'F');
                    }
                    
                    doc.text(item.length, 25, yPos);
                    doc.text(item.price.toFixed(2), 70, yPos);
                    doc.text(item.product.substring(0, 15), 110, yPos);
                    doc.text(item.density.substring(0, 10), 150, yPos);
                    doc.text(item.color.substring(0, 8), 175, yPos);
                    yPos += 8;
                    
                    // Add new page if needed
                    if (yPos > 270) {
                        doc.addPage();
                        yPos = 20;
                    }
                });
                
                yPos += 10; // Space between segments
            });
            
            // Footer on last page
            doc.setFontSize(8);
            doc.text('Contact: info@indiannaturalhair.com', 105, 280, { align: 'center' });
            
            // Share or download
            const pdfBlob = doc.output('blob');
            if (navigator.share) {
                const file = new File([pdfBlob], 'price-list.pdf', { type: 'application/pdf' });
                navigator.share({
                    title: 'Price List',
                    files: [file]
                }).catch(() => {
                    // Fallback to download
                    doc.save('price-list.pdf');
                });
            } else {
                // Fallback to download
                doc.save('price-list.pdf');
            }
        }

        // Initialize the application
        function init() {
            loadFromLocalStorage();
            loadProductData();
            
            // Add event listeners
            document.getElementById('categorySelect').addEventListener('change', function(e) {
                currentCategory = e.target.value;
                selectedProducts = [];
                selectedDensities = [];
                selectedColors = [];
                
                
                if (currentCategory) {
                    populateProducts(currentCategory);
                    checkKgAvailability(currentCategory);

                } else {
                    document.getElementById('productCheckboxes').innerHTML = '<p style="color: #6b7280; font-size: 14px;">Select a category first</p>';
                    document.getElementById('densityCheckboxes').innerHTML = '<p style="color: #6b7280; font-size: 14px;">Select products first</p>';
                    document.getElementById('colorCheckboxes').innerHTML = '<p style="color: #6b7280; font-size: 14px;">Select densities first</p>';
                    document.getElementById('kgCheckboxContainer').classList.add('hidden');
                    // Hide dynamic Select All button
                    document.getElementById('dynamicSelectAllContainer').classList.add('hidden');
                }
                
                updateSelectionSummary();
                updateRealTimePricing();
            });
            
            document.getElementById('currencySelect').addEventListener('change', updateRealTimePricing);
            document.getElementById('listInKg').addEventListener('change', updateRealTimePricing);

            document.getElementById('selectAllBtn').addEventListener('click', toggleSelectAll);
            document.getElementById('generateAllBtn').addEventListener('click', generateAllCombinations);
            document.getElementById('addToList').addEventListener('click', addToList);
            document.getElementById('downloadBtn').addEventListener('click', downloadPDF);
            document.getElementById('shareBtn').addEventListener('click', shareList);
            
            // Generate initial preview
            generatePreview();
        }

        // Start the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>