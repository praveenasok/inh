#!/bin/sh
#
# Pre-commit hook to validate data sources and ensure Firebase sync
# This ensures data consistency before commits

echo "ğŸ” Running pre-commit validation..."

# Validate data sources (Firebase and Google Sheets configuration)
echo "ğŸ“Š Validating data sources..."
if ! npm run validate-data > /dev/null 2>&1; then
    echo "âŒ Error: Data source validation failed!"
    echo "   Please check Firebase and Google Sheets configuration."
    exit 1
fi

# Check if data.json needs updating from Firebase
if [ -f "data.json" ]; then
    echo "ğŸ“ Checking if data.json needs updating from Firebase..."
    
    # Generate fresh data.json from Firebase
    if node deploy.js --sync-only; then
        echo "âœ… data.json synchronized with Firebase"
        git add data.json
    else
        echo "âŒ Error: Failed to sync data.json from Firebase"
        exit 1
    fi
else
    echo "ğŸ“ Creating data.json from Firebase..."
    
    # Generate data.json from Firebase
    if node deploy.js --sync-only; then
        echo "âœ… data.json created from Firebase"
        git add data.json
    else
        echo "âŒ Error: Failed to create data.json from Firebase"
        exit 1
    fi
fi

echo "âœ… Pre-commit validation passed!"
exit 0