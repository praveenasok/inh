<!DOCTYPE html>
<!-- saved from url=(0063)file:///Users/praveenasok/Desktop/inh2%20copy/index_remade.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Price List Generator — Indian Natural Hair</title>
  <script src="./Price List Generator — Indian Natural Hair_files/saved_resource"></script>
  <style>
    /* Canvas card */
    .shadow-soft { box-shadow: 0 10px 25px rgba(0,0,0,0.08); }
    @media (max-width: 640px) {
      .stack-mobile { flex-direction: column; }
    }
  </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.mx-auto{margin-left:auto;margin-right:auto}.mb-1{margin-bottom:0.25rem}.mb-3{margin-bottom:0.75rem}.mb-4{margin-bottom:1rem}.mt-1{margin-top:0.25rem}.mt-2{margin-top:0.5rem}.mt-6{margin-top:1.5rem}.block{display:block}.flex{display:flex}.inline-flex{display:inline-flex}.hidden{display:none}.h-4{height:1rem}.min-h-screen{min-height:100vh}.w-4{width:1rem}.w-full{width:100%}.max-w-6xl{max-width:72rem}.max-w-\[840px\]{max-width:840px}.flex-1{flex:1 1 0%}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.gap-4{gap:1rem}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.overflow-auto{overflow:auto}.rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}.border{border-width:1px}.bg-emerald-600{--tw-bg-opacity:1;background-color:rgb(5 150 105 / var(--tw-bg-opacity, 1))}.bg-slate-100{--tw-bg-opacity:1;background-color:rgb(241 245 249 / var(--tw-bg-opacity, 1))}.bg-slate-200{--tw-bg-opacity:1;background-color:rgb(226 232 240 / var(--tw-bg-opacity, 1))}.bg-slate-700{--tw-bg-opacity:1;background-color:rgb(51 65 85 / var(--tw-bg-opacity, 1))}.bg-slate-900{--tw-bg-opacity:1;background-color:rgb(15 23 42 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.p-4{padding:1rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.text-center{text-align:center}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-bold{font-weight:700}.font-semibold{font-weight:600}.text-slate-500{--tw-text-opacity:1;color:rgb(100 116 139 / var(--tw-text-opacity, 1))}.text-slate-700{--tw-text-opacity:1;color:rgb(51 65 85 / var(--tw-text-opacity, 1))}.text-slate-800{--tw-text-opacity:1;color:rgb(30 41 59 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.opacity-60{opacity:0.6}.disabled\:opacity-40:disabled{opacity:0.4}@media (min-width: 640px){.sm\:w-80{width:20rem}.sm\:p-5{padding:1.25rem}.sm\:p-6{padding:1.5rem}.sm\:text-2xl{font-size:1.5rem;line-height:2rem}.sm\:text-sm{font-size:0.875rem;line-height:1.25rem}}</style></head>
<body class="bg-slate-100 min-h-screen text-slate-800">
  <div class="max-w-6xl mx-auto p-4 sm:p-6">
    <header class="mb-4 flex items-center justify-between gap-3">
      <h1 class="text-xl sm:text-2xl font-bold">Price List Generator</h1>
      <div class="text-xs sm:text-sm text-slate-500">Base: INR • Live FX with fallback</div>
    </header>

    <div class="flex gap-4 stack-mobile">
      <!-- Controls -->
      <aside class="w-full sm:w-80 bg-white rounded-xl shadow-soft p-4 sm:p-5">
        <div class="space-y-4">
          <!-- Currency & FX -->
          <div>
            <label class="block text-sm font-semibold mb-1">Currency</label>
            <div class="flex gap-2">
              <select id="currency" class="w-full border rounded-lg px-3 py-2">
                <option value="INR">₹ INR</option>
                <option value="USD">$ USD</option>
                <option value="EUR">€ EUR</option>
                <option value="GBP">£ GBP</option>
                <option value="AUD">A$ AUD</option>
                <option value="SAR">SAR</option>
                <option value="NGN">₦ NAIRA</option>
                <option value="AED">د.إ AED</option>
              </select>
              <button id="fxRefresh" class="px-3 py-2 rounded-lg bg-slate-900 text-white text-sm">Refresh</button>
            </div>
            <div id="fxInfo" class="text-xs text-slate-500 mt-1">1 INR = { USD:0.0114 | EUR:0.0097 | GBP:0.0084 | AUD:0.0174 | SAR:0.0426 | NGN:17.4374 | AED:0.0417 } • 8/31/2025, 7:18:26 PM • live</div>
          </div>

          <!-- Dropdowns -->
          <div>
            <label class="block text-sm font-semibold mb-1">Category</label>
            <select id="category" class="w-full border rounded-lg px-3 py-2"><option value="">Select Category</option><option value="genius weaves">genius weaves</option><option value="tapes">tapes</option><option value="wigs, closures, and toppers">wigs, closures, and toppers</option></select>
            <div id="kgWrap" class="mt-2 hidden">
              <label class="inline-flex items-center gap-2 text-sm">
                <input type="checkbox" id="kgMode" class="w-4 h-4">
                <span>List in Kg (×10)</span>
              </label>
            </div>
          </div>

          <div>
            <label class="block text-sm font-semibold mb-1">Product</label>
            <select id="product" class="w-full border rounded-lg px-3 py-2"><option value="">Select Product</option><option value="Lace Front Wig">Lace Front Wig</option></select>
          </div>

          <div>
            <label class="block text-sm font-semibold mb-1">Density</label>
            <select id="density" class="w-full border rounded-lg px-3 py-2"><option value="">Select Density</option><option value="130%">130%</option></select>
          </div>

          <div>
            <label class="block text-sm font-semibold mb-1">Color</label>
            <select id="color" class="w-full border rounded-lg px-3 py-2"><option value="">Select Color</option><option value="Natural Black">Natural Black</option></select>
          </div>

          <!-- Actions -->
          <div class="flex gap-2">
            <button id="addRows" class="flex-1 px-3 py-2 rounded-lg bg-emerald-600 text-white disabled:opacity-40">Add</button>
            <button id="clearRows" class="px-3 py-2 rounded-lg bg-slate-200 text-slate-700">Clear</button>
          </div>
        </div>
      </aside>

      <!-- Preview -->
      <main class="flex-1 bg-white rounded-xl shadow-soft p-4 sm:p-5">
        <div class="mb-3 flex flex-wrap items-center gap-2 justify-between">
          <div class="text-sm text-slate-500">
            Header image auto-picks by category • Logo on left • Footer always shows address &amp; email
          </div>
          <div class="flex gap-2">
            <button id="downloadImg" class="px-3 py-2 rounded-lg bg-slate-900 text-white text-sm">Download Image</button>
            <button id="shareImg" class="px-3 py-2 rounded-lg bg-slate-700 text-white text-sm">Share</button>
          </div>
        </div>
        <div class="w-full overflow-auto">
          <canvas id="preview" class="w-full max-w-[840px] mx-auto rounded-xl border" style="aspect-ratio: 3 / 4; width: 840px; height: 1120px;" width="1680" height="2240"></canvas>
        </div>
      </main>
    </div>

    <footer class="text-center text-xs text-slate-500 mt-6">
      Place required assets in <code>/assets</code>:
      <code>logo.png</code>,
      <code>geniusstamps.png</code>,
      <code>lacestamps.png</code>,
      <code>tapesstamps.png</code>,
      <code>tipsstamps.png</code>,
      <code>generalstamps.png</code>.
    </footer>
  </div>

  <script>
    /* ---------- Config ---------- */
    const PRODUCT_JSON_PATH = './ProductDataJson280225.json'; // keep your existing filename
    const ADDRESS_LINES = [
      'WZ 81/1A, Guru Nanak Nagar, New Delhi 110018, India',
      'info@indiannaturalhair.com'
    ];
    const CATEGORY_STAMPS = {
      'genius weaves': '/assets/geniusstamps.png',
      'wigs, closures, and toppers': '/assets/lacestamps.png',
      'tapes': '/assets/tapesstamps.png',
      'tips': '/assets/tipsstamps.png',
      '__default': '/assets/generalstamps.png'
    };
    const LOGO_PATH = '/assets/logo.png';

    // Free FX APIs (use any; we try both, fallback to stored/default)
    const FX_APIS = [
      (base) => `https://open.er-api.com/v6/latest/${base}`,
      (base) => `https://api.exchangerate.host/latest?base=${base}`
    ];

    // Supported currencies (convert from INR only)
    const SUPPORTED = ['INR','USD','EUR','GBP','AUD','SAR','NGN','AED'];
    const SYMBOL = { INR:'₹', USD:'$', EUR:'€', GBP:'£', AUD:'A$', SAR:'SAR ', NGN:'₦', AED:'د.إ ' };

    // Fallback rates (rough placeholders)
    const DEFAULT_RATES = { base:'INR',
      rates:{ INR:1, USD:0.012, EUR:0.011, GBP:0.0095, AUD:0.018, SAR:0.045, NGN:5.5, AED:0.044 },
      updatedAt: null
    };

    /* ---------- State ---------- */
    let productData = [];
    let state = {
      currency: 'INR',
      rates: { ...DEFAULT_RATES },
      category: '',
      product: '',
      density: '',
      color: '',
      kg: false,
      rows: [] // rows for current PD C (array of {length, priceINR, meta})
    };

    /* ---------- DOM ---------- */
    const $ = (id) => document.getElementById(id);
    const elCurrency = $('currency');
    const elFxRefresh = $('fxRefresh');
    const elFxInfo = $('fxInfo');

    const elCategory = $('category');
    const elProduct = $('product');
    const elDensity = $('density');
    const elColor = $('color');
    const elKgWrap = $('kgWrap');
    const elKg = $('kgMode');

    const elAddRows = $('addRows');
    const elClearRows = $('clearRows');

    const elPreview = $('preview');
    const ctx = elPreview.getContext('2d');

    const elDownload = $('downloadImg');
    const elShare = $('shareImg');

    /* ---------- Data Load ---------- */
    async function loadProducts() {
      try {
        const res = await fetch(PRODUCT_JSON_PATH, { cache:'no-store' });
        productData = await res.json();
      } catch (e) {
        console.warn('Failed to load product JSON. Using minimal sample.', e);
        productData = [
          // Mini sample with the required fields present
          {"Catagory":"genius weaves","Product":"Genius Weft","Density":"Light","Colors":"Natural Black","Length":"12","Rate":"3500","Can Be Sold in KG?":"Y"},
          {"Catagory":"genius weaves","Product":"Genius Weft","Density":"Light","Colors":"Dark Brown","Length":"12","Rate":"3700","Can Be Sold in KG?":"Y"},
          {"Catagory":"wigs, closures, and toppers","Product":"Lace Front Wig","Density":"130%","Colors":"Natural Black","Length":"14","Rate":"12000","Can Be Sold in KG?":"N"},
          {"Catagory":"tapes","Product":"Tape-Ins","Density":"Standard","Colors":"Natural Black","Length":"18","Rate":"3000","Can Be Sold in KG?":"N"}
        ];
      }
      populateCategories();
    }

    function populateCategories() {
      const categories = [...new Set(productData.map(i => i.Catagory))].sort();
      elCategory.innerHTML = '<option value="">Select Category</option>'
        + categories.map(c => `<option value="${escapeHTML(c)}">${escapeHTML(c)}</option>`).join('');
      lockSelect(elProduct, true);
      lockSelect(elDensity, true);
      lockSelect(elColor, true);
      elAddRows.disabled = true;
    }

    function onCategoryChange() {
      state.category = elCategory.value;
      // KG availability
      const hasKg = productData.some(i => i.Catagory===state.category && /y/i.test(i['Can Be Sold in KG?']||''));
      elKgWrap.classList.toggle('hidden', !hasKg);
      if (!hasKg) { elKg.checked = false; state.kg = false; }

      // populate products
      const products = [...new Set(productData.filter(i => i.Catagory===state.category).map(i => i.Product))].sort();
      fillSelect(elProduct, products, 'Select Product');
      lockSelect(elProduct, state.category==='');
      // reset children
      fillSelect(elDensity, [], 'Select Density', true);
      fillSelect(elColor, [], 'Select Color', true);
      state.product = state.density = state.color = '';
      state.rows = [];
      draw();
    }

    function onProductChange() {
      state.product = elProduct.value;
      const densities = [...new Set(
        productData.filter(i => i.Catagory===state.category && i.Product===state.product).map(i => i.Density)
      )].sort();
      fillSelect(elDensity, densities, 'Select Density');
      lockSelect(elDensity, state.product==='');
      // reset child
      fillSelect(elColor, [], 'Select Color', true);
      state.density = state.color = '';
      state.rows = [];
      draw();
    }

    function onDensityChange() {
      state.density = elDensity.value;
      const colors = [...new Set(
        productData.filter(i => i.Catagory===state.category && i.Product===state.product && i.Density===state.density).map(i => i.Colors)
      )].sort();
      fillSelect(elColor, colors, 'Select Color');
      lockSelect(elColor, state.density==='');
      state.color = '';
      state.rows = [];
      draw();
    }

    function onColorChange() {
      state.color = elColor.value;
      // enable Add
      elAddRows.disabled = !(state.category && state.product && state.density && state.color);
      // pre-build rows for this combo
      state.rows = buildRowsForCurrentCombo();
      draw();
    }

    function onKgToggle() {
      state.kg = elKg.checked;
      state.rows = buildRowsForCurrentCombo();
      draw();
    }

    function buildRowsForCurrentCombo() {
      if (!state.category || !state.product || !state.density || !state.color) return [];
      const items = productData.filter(i =>
        i.Catagory===state.category && i.Product===state.product && i.Density===state.density && i.Colors===state.color
      );
      // map to rows
      return items.map(i => ({
        length: (i.Length || '').toString(),
        priceINR: parseFloat(i.Rate || '0') * (state.kg && /y/i.test(i['Can Be Sold in KG?']||'') ? 10 : 1),
        meta: i
      })).sort((a,b) => parseFloat(a.length) - parseFloat(b.length));
    }

    function addRowsToPreview() {
      // no-op as we already show the selected combo; but we keep the action for parity
      // Could be extended later to build multi-segment previews
      // Here we simply redraw (rows already set)
      draw();
    }

    function clearRows() {
      state.rows = [];
      draw();
    }

    function lockSelect(el, locked) {
      el.disabled = locked;
      el.classList.toggle('opacity-60', locked);
    }

    function fillSelect(el, arr, placeholder, lock = false) {
      el.innerHTML = `<option value="">${placeholder}</option>` + arr.map(v => `<option value="${escapeHTML(v)}">${escapeHTML(v)}</option>`).join('');
      lockSelect(el, lock || arr.length===0);
    }

    /* ---------- FX Handling ---------- */
    async function loadRates() {
      // Try localStorage
      const saved = JSON.parse(localStorage.getItem('INH_FX') || 'null');
      if (saved && saved.base==='INR' && saved.rates) {
        state.rates = saved;
        renderFxInfo('loaded from cache');
      } else {
        state.rates = { ...DEFAULT_RATES };
      }
      // Fetch live
      await refreshRates(true);
    }

    function renderFxInfo(extra='') {
      const when = state.rates.updatedAt ? new Date(state.rates.updatedAt).toLocaleString() : 'fallback';
      elFxInfo.textContent = `1 INR = { USD:${fmt(state.rates.rates.USD)} | EUR:${fmt(state.rates.rates.EUR)} | GBP:${fmt(state.rates.rates.GBP)} | AUD:${fmt(state.rates.rates.AUD)} | SAR:${fmt(state.rates.rates.SAR)} | NGN:${fmt(state.rates.rates.NGN)} | AED:${fmt(state.rates.rates.AED)} } • ${when}${extra?(' • '+extra):''}`;
    }

    async function refreshRates(silent=false) {
      let ok = false;
      for (const builder of FX_APIS) {
        try {
          const url = builder('INR');
          const res = await fetch(url, { cache:'no-store' });
          if (!res.ok) continue;
          const data = await res.json();
          let ratesRaw = data.rates || (data.result==='success' && data.rates) || data;
          // open.er-api format: data.rates; exchangerate.host: data.rates
          if (!ratesRaw) continue;
          const next = { base:'INR', rates:{}, updatedAt: Date.now() };
          SUPPORTED.forEach(k => {
            if (k==='INR') { next.rates[k] = 1; return; }
            // Both APIs return rates with base=INR directly or we need 1 INR -> k
            const v = ratesRaw[k];
            if (typeof v === 'number') next.rates[k] = v; // already INR->K
          });
          // basic sanity
          if (Object.keys(next.rates).length >= 4) {
            state.rates = next;
            localStorage.setItem('INH_FX', JSON.stringify(next));
            ok = true;
            break;
          }
        } catch (e) { /* try next */ }
      }
      if (!ok && !silent) alert('Live FX fetch failed. Using last saved or fallback rates.');
      renderFxInfo(ok ? 'live' : 'fallback');
      draw();
    }

    function convertINRto(curr, amountINR) {
      const rate = (state.rates.rates && state.rates.rates[curr]) || 0;
      return amountINR * (rate || 0);
    }

    /* ---------- Canvas Preview ---------- */
    function setupCanvas() {
      const w = 840, h = 1120; // share-friendly
      const dpr = window.devicePixelRatio || 1;
      elPreview.width = w * dpr;
      elPreview.height = h * dpr;
      elPreview.style.width = w + 'px';
      elPreview.style.height = h + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    async function draw() {
      setupCanvas();
      const W = elPreview.width / (window.devicePixelRatio||1);
      const H = elPreview.height / (window.devicePixelRatio||1);

      // bg
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0,0,W,H);

      // header card
      ctx.fillStyle = '#0f172a';
      ctx.fillRect(0,0,W,160);

      // logo (left)
      await drawImage(LOGO_PATH, 24, 24, 130, 112).catch(()=>{});

      // category stamp (right)
      const stampPath = CATEGORY_STAMPS[state.category] || CATEGORY_STAMPS.__default;
      await drawImage(stampPath, W-180, 16, 160, 128).catch(()=>{});

      // title
      ctx.fillStyle = '#ffffff';
      ctx.font = '700 28px system-ui, -apple-system, Segoe UI, Roboto';
      const title = buildTitle();
      ctx.textAlign = 'center';
      ctx.fillText(title, W/2, 96);

      // currency + mode line
      ctx.font = '500 14px system-ui, -apple-system, Segoe UI, Roboto';
      ctx.fillText(`Currency: ${state.currency} • ${state.kg ? 'KG Mode (×10)' : 'Per Piece'}`, W/2, 124);

      // table header
      let y = 200;
      const xPad = 28;
      ctx.fillStyle = '#0f172a';
      roundRect(ctx, xPad, y, W-2*xPad, 36, 10, true);
      ctx.fillStyle = '#ffffff';
      ctx.font = '600 14px system-ui, -apple-system, Segoe UI, Roboto';
      ctx.textAlign = 'left';
      ctx.fillText('Length', xPad+16, y+23);
      ctx.textAlign = 'right';
      ctx.fillText(`Price (${SYMBOL[state.currency] || ''})`, W - xPad - 16, y+23);
      y += 36;

      // rows
      if (state.rows.length === 0) {
        ctx.fillStyle = '#64748b';
        ctx.textAlign = 'center';
        ctx.font = '500 16px system-ui, -apple-system, Segoe UI, Roboto';
        ctx.fillText('Select Category → Product → Density → Color to preview prices', W/2, y+40);
      } else {
        state.rows.forEach((row, idx) => {
          const rowH = 34;
          // alt bg
          if (idx % 2 === 0) {
            ctx.fillStyle = '#f8fafc';
            ctx.fillRect(xPad, y, W-2*xPad, rowH);
          }
          // length
          ctx.fillStyle = '#0f172a';
          ctx.textAlign = 'left';
          ctx.font = '500 14px system-ui, -apple-system, Segoe UI, Roboto';
          ctx.fillText(`${row.length}"`, xPad+16, y+22);

          // price
          const converted = state.currency==='INR' ? row.priceINR : convertINRto(state.currency, row.priceINR);
          ctx.textAlign = 'right';
          ctx.fillText(`${(SYMBOL[state.currency]||'')}${(converted||0).toFixed(2)}`, W - xPad - 16, y+22);
          y += rowH;
        });
      }

      // footer
      y = H - 64;
      ctx.fillStyle = '#f1f5f9';
      ctx.fillRect(0, y-8, W, 72);
      ctx.fillStyle = '#475569';
      ctx.textAlign = 'center';
      ctx.font = '500 12px system-ui, -apple-system, Segoe UI, Roboto';
      ctx.fillText(ADDRESS_LINES[0], W/2, y+8);
      ctx.fillText(ADDRESS_LINES[1], W/2, y+28);
    }

    function roundRect(ctx, x, y, w, h, r, fill) {
      const rr = Math.min(r, h/2, w/2);
      ctx.beginPath();
      ctx.moveTo(x+rr, y);
      ctx.arcTo(x+w, y, x+w, y+h, rr);
      ctx.arcTo(x+w, y+h, x, y+h, rr);
      ctx.arcTo(x, y+h, x, y, rr);
      ctx.arcTo(x, y, x+w, y, rr);
      ctx.closePath();
      if (fill) ctx.fill();
    }

    function drawImage(src, x, y, w, h) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => { ctx.drawImage(img, x, y, w, h); resolve(); };
        img.onerror = reject;
        img.src = src;
      });
    }

    function buildTitle() {
      const prod = state.product || 'Product';
      const den = state.density || 'Density';
      const col = state.color || 'Colors';
      return `${prod} - ${den} - ${col}`;
    }

    /* ---------- Share & Download ---------- */
    function canvasToBlob(canvas) {
      return new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
    }

    async function downloadImage() {
      const blob = await canvasToBlob(elPreview);
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const cat = (state.category||'general').replace(/\s+/g,'-');
      const prod = (state.product||'product').replace(/\s+/g,'-');
      const den  = (state.density||'density').replace(/\s+/g,'-');
      const col  = (state.color||'color').replace(/\s+/g,'-');
      a.href = url;
      a.download = `PriceList_${cat}_${prod}_${den}_${col}_${state.currency}.png`;
      a.click();
      URL.revokeObjectURL(url);
    }

    async function shareImage() {
      const blob = await canvasToBlob(elPreview);
      if (navigator.canShare && navigator.canShare({ files:[new File([blob],'price-list.png',{type:'image/png'})] })) {
        try {
          await navigator.share({
            title: 'Price List',
            files: [new File([blob], 'price-list.png', { type: 'image/png' })]
          });
          return;
        } catch (e) { /* fall back */ }
      }
      // fallback -> download
      downloadImage();
    }

    /* ---------- Utils ---------- */
    function fmt(n){ return (typeof n==='number' && isFinite(n)) ? n.toFixed(4) : '-'; }
    function escapeHTML(s){ return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    /* ---------- Init ---------- */
    async function init() {
      await loadProducts();
      await loadRates();
      // listeners
      elCurrency.addEventListener('change', () => { state.currency = elCurrency.value; draw(); });
      elFxRefresh.addEventListener('click', () => refreshRates(false));

      elCategory.addEventListener('change', onCategoryChange);
      elProduct.addEventListener('change', onProductChange);
      elDensity.addEventListener('change', onDensityChange);
      elColor.addEventListener('change', onColorChange);
      elKg.addEventListener('change', onKgToggle);

      elAddRows.addEventListener('click', addRowsToPreview);
      elClearRows.addEventListener('click', clearRows);

      elDownload.addEventListener('click', downloadImage);
      elShare.addEventListener('click', shareImage);

      draw();
    }

    init();
  </script>


</body></html>