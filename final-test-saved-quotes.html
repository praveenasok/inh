<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Test - Saved Quotes</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 8px; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; border-radius: 4px; max-height: 300px; overflow-y: auto; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        .warning { color: #ffc107; }
        .step { background: #e9ecef; padding: 10px; margin: 10px 0; border-left: 4px solid #007bff; }
    </style>
</head>
<body>
    <h1>Final Test - Saved Quotes Functionality</h1>
    
    <div class="step">
        <strong>Test Steps:</strong>
        <ol>
            <li>Clear localStorage and add test quotes</li>
            <li>Open main app and navigate to Quote Maker</li>
            <li>Check if saved quotes are displayed</li>
            <li>Verify debug logs in browser console</li>
        </ol>
    </div>
    
    <div class="test-section">
        <h3>Step 1: Prepare Test Data</h3>
        <button onclick="setupTestData()">Setup Test Quotes</button>
        <button onclick="checkLocalStorage()">Check localStorage</button>
        <button onclick="clearLocalStorage()">Clear localStorage</button>
        <div id="setup-log" class="log"></div>
    </div>
    
    <div class="test-section">
        <h3>Step 2: Test Navigation</h3>
        <button onclick="openQuoteMaker()">Open Quote Maker</button>
        <button onclick="openQuoteMakerDirect()">Direct Link to Quote Maker</button>
        <div id="nav-log" class="log"></div>
    </div>
    
    <div class="test-section">
        <h3>Step 3: Manual Verification</h3>
        <p>After opening the Quote Maker:</p>
        <ul>
            <li>Check if saved quotes appear in the "Saved Quotes List" section</li>
            <li>Open browser console (F12) and look for debug messages</li>
            <li>Look for messages like "üîÑ renderSavedQuotesList called" and "üìä Total quotes found"</li>
        </ul>
    </div>
    
    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'info';
            element.innerHTML += `<span class="${className}">${timestamp}: ${message}</span>\n`;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function setupTestData() {
            const logElement = 'setup-log';
            document.getElementById(logElement).innerHTML = '';
            
            // Clear existing data
            localStorage.removeItem('savedQuotes');
            log(logElement, 'üóëÔ∏è Cleared existing localStorage', 'info');
            
            // Create test quotes with proper structure
            const testQuotes = [
                {
                    id: 'QT-TEST-001',
                    quoteId: 'QT-TEST-001',
                    date: new Date().toISOString(),
                    createdAt: new Date().toISOString(),
                    savedAt: new Date().toISOString(),
                    clientName: 'Test Client Alpha',
                    salesperson: 'John Doe',
                    lines: [
                        { description: 'Product A', quantity: 2, price: 100, total: 200 },
                        { description: 'Product B', quantity: 1, price: 150, total: 150 }
                    ],
                    total: 350,
                    currency: 'USD'
                },
                {
                    id: 'QT-TEST-002',
                    quoteId: 'QT-TEST-002',
                    date: new Date(Date.now() - 86400000).toISOString(), // Yesterday
                    createdAt: new Date(Date.now() - 86400000).toISOString(),
                    savedAt: new Date(Date.now() - 86400000).toISOString(),
                    clientName: 'Test Client Beta',
                    salesperson: 'Jane Smith',
                    lines: [
                        { description: 'Service X', quantity: 3, price: 75, total: 225 },
                        { description: 'Service Y', quantity: 2, price: 120, total: 240 }
                    ],
                    total: 465,
                    currency: 'EUR'
                },
                {
                    id: 'QT-TEST-003',
                    quoteId: 'QT-TEST-003',
                    date: new Date(Date.now() - 172800000).toISOString(), // 2 days ago
                    createdAt: new Date(Date.now() - 172800000).toISOString(),
                    savedAt: new Date(Date.now() - 172800000).toISOString(),
                    clientName: 'Test Client Gamma',
                    salesperson: 'Bob Wilson',
                    lines: [
                        { description: 'Hardware Kit', quantity: 1, price: 500, total: 500 }
                    ],
                    total: 500,
                    currency: 'GBP'
                }
            ];
            
            // Save to localStorage
            localStorage.setItem('savedQuotes', JSON.stringify(testQuotes));
            
            log(logElement, `‚úÖ Created ${testQuotes.length} test quotes`, 'success');
            testQuotes.forEach((quote, index) => {
                log(logElement, `   ${index + 1}. ${quote.quoteId} - ${quote.clientName} (${quote.lines.length} items, ${quote.currency} ${quote.total})`, 'info');
            });
            
            log(logElement, 'üéØ Test data setup complete!', 'success');
        }
        
        function checkLocalStorage() {
            const logElement = 'setup-log';
            
            try {
                const quotes = localStorage.getItem('savedQuotes');
                if (quotes) {
                    const parsedQuotes = JSON.parse(quotes);
                    log(logElement, `üìä Found ${parsedQuotes.length} quotes in localStorage`, 'success');
                    
                    parsedQuotes.forEach((quote, index) => {
                        const itemCount = quote.lines ? quote.lines.length : (quote.items ? quote.items.length : 0);
                        log(logElement, `   ${index + 1}. ${quote.quoteId || quote.id} - ${quote.clientName || 'No client'} (${itemCount} items)`, 'info');
                    });
                } else {
                    log(logElement, '‚ùå No quotes found in localStorage', 'error');
                }
            } catch (error) {
                log(logElement, `‚ùå Error reading localStorage: ${error.message}`, 'error');
            }
        }
        
        function clearLocalStorage() {
            const logElement = 'setup-log';
            localStorage.removeItem('savedQuotes');
            log(logElement, 'üóëÔ∏è localStorage cleared', 'warning');
        }
        
        function openQuoteMaker() {
            const logElement = 'nav-log';
            document.getElementById(logElement).innerHTML = '';
            
            log(logElement, 'üöÄ Opening main app...', 'info');
            log(logElement, 'üëÜ Please manually navigate to Quote Maker module', 'warning');
            log(logElement, 'üîç Check browser console for debug messages', 'info');
            
            window.open('http://localhost:3000', '_blank');
        }
        
        function openQuoteMakerDirect() {
            const logElement = 'nav-log';
            document.getElementById(logElement).innerHTML = '';
            
            log(logElement, 'üéØ Opening Quote Maker directly...', 'info');
            log(logElement, 'üîç Check browser console for debug messages', 'info');
            log(logElement, 'üìã Look for saved quotes in the "Saved Quotes List" section', 'warning');
            
            // Open with hash to directly navigate to quote maker
            window.open('http://localhost:3000#quote-maker', '_blank');
        }
        
        // Auto-check localStorage on page load
        window.onload = function() {
            checkLocalStorage();
        };
    </script>
</body>
</html>