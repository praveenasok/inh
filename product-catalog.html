<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Catalog - InstaQuote</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>
    
    <!-- Language Configuration (Load First) -->
    <script src="js/language-config.js"></script>
    
    <!-- Firebase Configuration and Initialization -->
    <script src="firebase-config.js"></script>
    <script src="firebase-global-init.js"></script>
    <script src="firebase-database.js"></script>
    <script src="firebase-error-handler.js"></script>
    
    <!-- Universal Firebase Data Manager -->
    <script src="js/universal-firebase-data-manager.js"></script>
    
    <!-- Fallback System Components -->
    <script src="js/local-fallback-manager.js?v=4"></script>
    <script src="js/fallback-detector.js"></script>
    <script src="js/unified-data-access.js?v=20"></script>
    
    <!-- New API Client (Server-based data access) -->
    <script src="js/api-client.js"></script>
    
    <!-- Unified Button System -->
    <link rel="stylesheet" href="unified-button-system.css">
    
    <style>
        /* Responsive padding */
        .mobile-padding {
            padding: 1.5rem;
        }
        @media (max-width: 640px) {
            .mobile-padding {
                padding: 1rem;
            }
        }
        
        /* Shadow effects */
        .shadow-soft {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        /* Button styles now handled by unified-button-system.css */
        
        /* Mobile-first responsive design */
        @media (max-width: 768px) {
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            .text-responsive {
                font-size: 0.875rem;
            }
        }
        
        /* Form elements */
        .form-input {
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            padding: 0.75rem;
            transition: all 0.3s ease;
            background: white;
        }
        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        /* Card hover effects */
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* Navigation styles now handled by unified-button-system.css */
        
        /* Module content display */
        .module-content {
            display: block;
        }
        
        /* Navigation link styles */
        .nav-btn {
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-height: 48px;
            padding: 12px 16px;
            font-weight: 500;
            cursor: pointer;
            touch-action: manipulation;
            border-radius: 8px;
            transition: all 0.2s ease;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border: 2px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(71, 85, 105, 0.15);
        }
        
        .nav-btn:hover {
            text-decoration: none;
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            border-color: #cbd5e1;
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(71, 85, 105, 0.2);
        }
        
        .nav-btn.nav-btn-active {
            background: #081249;
            color: white !important;
            border: 2px solid #081249;
            box-shadow: 0 4px 12px rgba(8, 18, 73, 0.3);
        }
        
        .nav-btn.nav-btn-active:hover {
            background: #0a1555;
            border-color: #0a1555;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(8, 18, 73, 0.4);
        }
        
        /* Remove default link styles */
        .no-underline {
            text-decoration: none !important;
        }
        
        .no-underline:hover {
            text-decoration: none !important;
        }
        
        /* Loading Overlay */
        .loading {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #081249;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Navigation Component -->
    <nav class="bg-gradient-to-r from-blue-900 via-blue-800 to-amber-700 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo and Title -->
                <div class="flex items-center space-x-3">
                    <img src="images/logo.png" alt="Logo" class="h-8 w-auto opacity-90">
                    <span class="text-lg font-bold">InstaQuote</span>
                </div>
                
                <!-- Navigation Links -->
                <div class="hidden md:flex items-center space-x-4">
                    <a href="quote-maker-v2-ver3.html" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-white/10 transition-colors">
                        <i class="fas fa-file-invoice-dollar mr-1"></i> Quote Maker
                    </a>
                    <a href="price-calculator.html" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-white/10 transition-colors">
                        <i class="fas fa-calculator mr-1"></i> Calculator
                    </a>
                    <span class="px-3 py-2 rounded-md text-sm font-medium bg-white/20">
                        <i class="fas fa-th-large mr-1"></i> Catalog
                    </span>
                    <a href="admin-panel.html" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-white/10 transition-colors">
                        <i class="fas fa-cog mr-1"></i> Admin
                    </a>
                </div>
                
                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button id="mobile-menu-btn" class="p-2 rounded-md hover:bg-white/10 transition-colors">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="md:hidden hidden pb-3">
                <div class="space-y-1">
                    <a href="quote-maker-v2-ver3.html" class="block px-3 py-2 rounded-md text-sm font-medium hover:bg-white/10 transition-colors">
                        <i class="fas fa-file-invoice-dollar mr-2"></i> Quote Maker
                    </a>
                    <a href="price-calculator.html" class="block px-3 py-2 rounded-md text-sm font-medium hover:bg-white/10 transition-colors">
                        <i class="fas fa-calculator mr-2"></i> Price Calculator
                    </a>
                    <span class="block px-3 py-2 rounded-md text-sm font-medium bg-white/20">
                        <i class="fas fa-th-large mr-2"></i> Product Catalog
                    </span>
                    <a href="admin-panel.html" class="block px-3 py-2 rounded-md text-sm font-medium hover:bg-white/10 transition-colors">
                        <i class="fas fa-cog mr-2"></i> Admin Panel
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-6">
        <!-- Page Header -->
        <div class="text-left mb-8">
            <h1 class="text-3xl font-bold mb-2" style="color: #081249;">Product Catalog</h1>
        </div>

        <!-- Product Catalog Module -->
        <div id="product-catalog-module" class="module-content">
            
            <!-- Modern Catalog Filters -->
            <section class="bg-white rounded-xl shadow-soft p-4 sm:p-6 mb-4 mobile-padding" style="background: #eef2ff;">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="section-heading flex items-center">
                        <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                        </svg>
                        Filters
                    </h3>
                    <div class="text-sm text-gray-500">
                        <span id="catalog-results-count">Loading products...</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <!-- Category Filter -->
                    <div>
                        <select id="catalog-category" class="w-full border-2 border-gray-200 rounded-lg px-4 py-3 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 focus:outline-none transition-all duration-200 bg-gray-50 hover:bg-white">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    
                    <!-- Search Filter -->
                    <div>
                        <div class="relative">
                            <input type="text" id="catalog-search" placeholder="Search products by name..." class="w-full border-2 border-gray-200 rounded-lg px-4 py-3 pl-10 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 focus:outline-none transition-all duration-200 bg-gray-50 hover:bg-white" />
                            <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-wrap gap-3">
                    <button id="catalog-filter-btn" class="text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 flex items-center" style="background-color: #081249; border-color: #081249;" onmouseover="this.style.backgroundColor='#0a1a5c'" onmouseout="this.style.backgroundColor='#081249'">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                        </svg>
                        Apply Filters
                    </button>
                    <button id="catalog-clear-btn" class="btn-secondary px-6 py-3 rounded-lg font-medium transition-all duration-200 flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                        Clear All
                    </button>
                </div>
            </section>

            <!-- Enhanced Product Grid -->
            <section class="bg-white rounded-xl shadow-soft p-4 sm:p-6 mb-4 mobile-padding" style="background: #f8fafc;">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="section-heading-large flex items-center">
                        <svg class="w-6 h-6 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                        </svg>
                        Our Products
                    </h3>
                    <div class="flex items-center space-x-4">
                        <div class="text-sm text-gray-500 bg-gray-50 px-3 py-1 rounded-full">
                            <span id="catalog-results-count-display">Loading...</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button id="grid-view-btn" class="p-2 rounded-lg bg-blue-100 text-blue-600 hover:bg-blue-200 transition-colors" title="Grid View">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                                </svg>
                            </button>
                            <button id="list-view-btn" class="p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors" title="List View">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Loading State -->
                <div id="catalog-loading" class="hidden flex items-center justify-center py-12">
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                        <p class="text-gray-600">Loading products...</p>
                    </div>
                </div>
                
                <!-- Empty State -->
                <div id="catalog-empty" class="hidden text-center py-12">
                    <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
                    </svg>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">No products found</h3>
                    <p class="text-gray-500 mb-4">Try adjusting your search criteria or browse all categories.</p>
                    <button onclick="clearCatalogFilters()" class="btn-primary px-4 py-2 rounded-lg">
                        View All Products
                    </button>
                </div>
                
                <!-- Product Cards Container -->
                <div id="catalog-products-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-4 sm:gap-6">
                    <!-- Products will be dynamically loaded here -->
                </div>
                
                <!-- Pagination -->
                <div id="catalog-pagination" class="flex justify-center mt-6">
                    <!-- Pagination controls will be added here -->
                </div>
            </section>
        </div>
    </div>

    <script>
        // Data arrays for consistency
    // Function to get product image based on category and product name
    function getProductImage(category, productName) {
        const categoryImageMap = {
            'Bulk': 'images/Products/Bulk.png',
            'Weaves': 'images/Products/Weaves-SD.png',
            'Weaves DD': 'images/Products/Weaves-DD.png',
            'Weaves SDD': 'images/Products/Weaves-SDD.png',
            'Tapes': 'images/Products/Tapes.png',
            'ClipOn': 'images/Products/ClipOn.png',
            'Closures': 'images/Products/Closure.png',
            'Frontals': 'images/Products/Frontal.png',
            'Frontline': 'images/Products/Frontline.png',
            'Tips': 'images/Products/ITIPS.png',
            'I Tips': 'images/Products/ITIPS.png',
            'U Tips': 'images/Products/UTIPS.png',
            'Y Tips': 'images/Products/YTIPS.png',
            'Flat Tips': 'images/Products/FlatTips.png',
            'Nano': 'images/Products/Nano.png',
            'PonyTail': 'images/Products/PonyTail.png',
            'BUN': 'images/Products/BUN.png',
            'Curly Bun': 'images/Products/CurlyBun.png',
            'Clutch Bun': 'images/Products/ClutchBun.png',
            'Bangs': 'images/Products/Bangs.png',
            'Halo': 'images/Products/Halo.png',
            'Highlights': 'images/Products/Highlights.png',
            'Cover Patch': 'images/Products/CoverPatch.png',
            'Genius': 'images/Products/Genius.png',
            'Genius Weaves': 'images/Products/Genius.png',
            'Wigs': 'images/Products/WIGFRONTAL.png',
            'Wig Closure': 'images/Products/WIGCLOSURE.png',
            'Wig Frontal': 'images/Products/WIGFRONTAL.png',
            'Silk Topper': 'images/Products/SILKTOPPER.png',
            'Toppers': 'images/Products/SILKTOPPER.png',
            'Flat Clip Ponytail': 'images/Products/FLATCLIPPONYTAIL.png',
            'Hair Extensions': 'images/Products/Weaves-SD.png'
        };
        
        // Check for specific product name matches first
        const productLower = productName.toLowerCase();
        if (productLower.includes('bulk')) return 'images/Products/Bulk.png';
        if (productLower.includes('weave') && productLower.includes('double drawn')) return 'images/Products/Weaves-DD.png';
        if (productLower.includes('weave') && productLower.includes('super double')) return 'images/Products/Weaves-SDD.png';
        if (productLower.includes('weave')) return 'images/Products/Weaves-SD.png';
        if (productLower.includes('tape')) return 'images/Products/Tapes.png';
        if (productLower.includes('closure')) return 'images/Products/Closure.png';
        if (productLower.includes('frontal')) return 'images/Products/Frontal.png';
        if (productLower.includes('genius')) return 'images/Products/Genius.png';
        if (productLower.includes('wig')) return 'images/Products/WIGFRONTAL.png';
        if (productLower.includes('tip')) return 'images/Products/ITIPS.png';
        if (productLower.includes('clip')) return 'images/Products/ClipOn.png';
        if (productLower.includes('ponytail')) return 'images/Products/PonyTail.png';
        if (productLower.includes('bun')) return 'images/Products/BUN.png';
        if (productLower.includes('bang')) return 'images/Products/Bangs.png';
        if (productLower.includes('halo')) return 'images/Products/Halo.png';
        if (productLower.includes('topper')) return 'images/Products/SILKTOPPER.png';
        
        // Fall back to category mapping
        return categoryImageMap[category] || 'images/template.png';
    }

    let productData = [
        {
            Product: "Premium Bulk Hair 18\"",
            Category: "Bulk",
            Rate: 2500,
            Currency: "INR",
            Colors: "Black, Brown, Blonde",
            Length: 18,
            Density: "150%",
            image: getProductImage("Bulk", "Premium Bulk Hair 18\"")
        },
        {
            Product: "Luxury Weaves Double Drawn 22\"",
            Category: "Weaves DD",
            Rate: 3200,
            Currency: "INR",
            Colors: "Black, Brown, Auburn",
            Length: 22,
            Density: "180%",
            image: getProductImage("Weaves DD", "Luxury Weaves Double Drawn 22\"")
        },
        {
            Product: "Natural Wave Weaves 20\"",
            Category: "Weaves",
            Rate: 2800,
            Currency: "INR",
            Colors: "Natural Black, Dark Brown",
            Length: 20,
            Density: "160%",
            image: getProductImage("Weaves", "Natural Wave Weaves 20\"")
        },
        {
            Product: "Tape Extensions 16\"",
            Category: "Tapes",
            Rate: 1800,
            Currency: "INR",
            Colors: "Black, Brown, Blonde, Auburn",
            Length: 16,
            Density: "120%",
            image: getProductImage("Tapes", "Tape Extensions 16\"")
        },
        {
            Product: "Lace Closure 4x4",
            Category: "Closures",
            Rate: 4500,
            Currency: "INR",
            Colors: "Natural Black, Dark Brown",
            Length: 14,
            Density: "130%",
            image: getProductImage("Closures", "Lace Closure 4x4")
        },
        {
            Product: "Lace Frontal 13x4",
            Category: "Frontals",
            Rate: 6500,
            Currency: "INR",
            Colors: "Natural Black, Brown",
            Length: 16,
            Density: "150%",
            image: getProductImage("Frontals", "Lace Frontal 13x4")
        },
        {
            Product: "I-Tips Extensions 18\"",
            Category: "I Tips",
            Rate: 2200,
            Currency: "INR",
            Colors: "Black, Brown, Blonde",
            Length: 18,
            Density: "140%",
            image: getProductImage("I Tips", "I-Tips Extensions 18\"")
        },
        {
            Product: "Clip-On Extensions 20\"",
            Category: "ClipOn",
            Rate: 1950,
            Currency: "INR",
            Colors: "Black, Brown, Blonde, Auburn",
            Length: 20,
            Density: "130%",
            image: getProductImage("ClipOn", "Clip-On Extensions 20\"")
        },
        {
            Product: "Genius Weaves 22\"",
            Category: "Genius Weaves",
            Rate: 3800,
            Currency: "INR",
            Colors: "Natural Black, Brown",
            Length: 22,
            Density: "170%",
            image: getProductImage("Genius Weaves", "Genius Weaves 22\"")
        },
        {
            Product: "Silk Top Topper 14\"",
            Category: "Toppers",
            Rate: 5200,
            Currency: "INR",
            Colors: "Natural Black, Dark Brown",
            Length: 14,
            Density: "150%",
            image: getProductImage("Toppers", "Silk Top Topper 14\"")
        }
    ];
    
    const FX_APIS = [
      (base) => `https://api.exchangerate-api.com/v4/latest/${base}`,
      (base) => `https://api.fixer.io/latest?base=${base}`,
      (base) => `https://open.er-api.com/v6/latest/${base}`
    ];
    const SUPPORTED = ['INR','USD','EUR','GBP','AUD','SAR','NGN','AED','JPY'];
    const SYMBOL = { INR:'â‚¹', USD:'$', EUR:'â‚¬', GBP:'Â£', AUD:'A$', SAR:'SAR ', NGN:'â‚¦', AED:'Ø¯.Ø¥ ', JPY:'Â¥' };
    const DEFAULT_RATES = { base:'INR',
      rates:{ INR:1, USD:0.0120, EUR:0.0110, GBP:0.0095, AUD:0.0180, SAR:0.0450, NGN:5.5000, AED:0.0440, JPY:1.8000 },
      updatedAt: null, mode:'auto'
    };

    // Global variables for Firebase collections
    let firebaseColors = [];
    let firebaseStyles = [];

    // Function to get collections data via API client
    async function loadFirebaseCollections() {
        try {
            // Use API client for data access if available
            if (window.apiClient && typeof window.apiClient.isAvailable === 'function' && window.apiClient.isAvailable()) {
                // Load colors collection
                const colors = await window.apiClient.getColors();
                if (colors && colors.length > 0) {
                    firebaseColors = colors;
                    console.log(`ðŸ“¦ Loaded ${firebaseColors.length} colors from API client`);
                }
                
                // Load styles collection
                const styles = await window.apiClient.getStyles();
                if (styles && styles.length > 0) {
                    firebaseStyles = styles;
                    console.log(`ðŸ“¦ Loaded ${firebaseStyles.length} styles from API client`);
                }
                return;
            }
            
            // Fallback: Try unified data access if API client is not available
            console.warn('âš ï¸ API client not available or API endpoints not found, falling back to legacy methods...');
            
            if (window.unifiedDataAccess) {
                try {
                    // Load colors collection
                    const colors = await window.unifiedDataAccess.getColors();
                    if (colors && colors.length > 0) {
                        firebaseColors = colors;
                        console.log(`ðŸ“¦ Loaded ${firebaseColors.length} colors from unified data access (fallback)`);
                    }
                    
                    // Load styles collection
                    const styles = await window.unifiedDataAccess.getStyles();
                    if (styles && styles.length > 0) {
                        firebaseStyles = styles;
                        console.log(`ðŸ“¦ Loaded ${firebaseStyles.length} styles from unified data access (fallback)`);
                    }
                } catch (unifiedError) {
                    console.warn('âš ï¸ Unified data access failed:', unifiedError);
                }
            }
        } catch (error) {
            console.error('Error loading Firebase collections:', error);
        }
    }

    // Function to get product image based on category
    function getCategoryImage(category) {
        const categoryImageMap = {
            'Bulk': 'images/Products/Bulk.png',
            'Weaves': 'images/Products/Weaves-SD.png',
            'Weaves DD': 'images/Products/Weaves-DD.png',
            'Weaves SDD': 'images/Products/Weaves-SDD.png',
            'Tapes': 'images/Products/Tapes.png',
            'ClipOn': 'images/Products/ClipOn.png',
            'Closures': 'images/Products/Closure.png',
            'Frontals': 'images/Products/Frontal.png',
            'Frontline': 'images/Products/Frontline.png',
            'Tips': 'images/Products/ITIPS.png',
            'I Tips': 'images/Products/ITIPS.png',
            'U Tips': 'images/Products/UTIPS.png',
            'Y Tips': 'images/Products/YTIPS.png',
            'Flat Tips': 'images/Products/FlatTips.png',
            'Nano': 'images/Products/Nano.png',
            'PonyTail': 'images/Products/PonyTail.png',
            'BUN': 'images/Products/BUN.png',
            'Curly Bun': 'images/Products/CurlyBun.png',
            'Clutch Bun': 'images/Products/ClutchBun.png',
            'Bangs': 'images/Products/Bangs.png',
            'Halo': 'images/Products/Halo.png',
            'Highlights': 'images/Products/Highlights.png',
            'Cover Patch': 'images/Products/CoverPatch.png',
            'Genius': 'images/Products/Genius.png',
            'Genius Weaves': 'images/Products/Genius.png',
            'Wigs': 'images/Products/WIGFRONTAL.png',
            'Wig Closure': 'images/Products/WIGCLOSURE.png',
            'Wig Frontal': 'images/Products/WIGFRONTAL.png',
            'Silk Topper': 'images/Products/SILKTOPPER.png',
            'Toppers': 'images/Products/SILKTOPPER.png',
            'Flat Clip Ponytail': 'images/Products/FLATCLIPPONYTAIL.png',
            'Hair Extensions': 'images/Products/Weaves-SD.png'
        };
        
        return categoryImageMap[category] || 'images/template.png';
    }

    // Function to calculate ranges for a category
    function calculateCategoryRanges(category) {
        const categoryProducts = productData.filter(p => p.Category === category);
        
        if (categoryProducts.length === 0) {
            return {
                priceRange: 'N/A',
                lengthRange: 'N/A',
                colorRange: 'N/A',
                styleRange: 'N/A'
            };
        }
        
        // Calculate price range
        const prices = categoryProducts.map(p => p.Rate).filter(Boolean);
        const priceRange = prices.length > 1 ? 
            `${SYMBOL[categoryProducts[0].Currency] || ''}${Math.min(...prices)} - ${SYMBOL[categoryProducts[0].Currency] || ''}${Math.max(...prices)}` :
            `${SYMBOL[categoryProducts[0].Currency] || ''}${prices[0] || 'N/A'}`;
        
        // Calculate length range
        const lengths = categoryProducts.map(p => p.Length).filter(Boolean);
        const lengthRange = lengths.length > 1 ? 
            `${Math.min(...lengths)}" - ${Math.max(...lengths)}"` :
            `${lengths[0] || 'N/A'}"`;
        
        // Use Firebase collections for color and style counts
        const colorRange = firebaseColors.length > 0 ? 
            `${firebaseColors.length} colors available` :
            'Colors available';
        
        const styleRange = firebaseStyles.length > 0 ? 
            `${firebaseStyles.length} styles available` :
            'Styles available';
        
        return { priceRange, lengthRange, colorRange, styleRange };
    }

    // Product rendering function
    async function renderProducts(products = productData) {
        const grid = document.getElementById('catalog-products-grid');
        
        // Load Firebase collections if not already loaded
        if (firebaseColors.length === 0 || firebaseStyles.length === 0) {
            await loadFirebaseCollections();
        }
        
        if (!products || products.length === 0) {
            document.getElementById('catalog-empty').classList.remove('hidden');
            grid.innerHTML = '';
            return;
        }
        
        document.getElementById('catalog-empty').classList.add('hidden');
        
        // Group products by category to show ranges
        const productsByCategory = {};
        products.forEach(product => {
            if (!productsByCategory[product.Category]) {
                productsByCategory[product.Category] = [];
            }
            productsByCategory[product.Category].push(product);
        });
        
        grid.innerHTML = Object.entries(productsByCategory).map(([category, categoryProducts]) => {
            const ranges = calculateCategoryRanges(category);
            const representativeProduct = categoryProducts[0]; // Use first product as representative
            const categoryImage = getCategoryImage(category);
            
            return `
                <div class="bg-white rounded-lg shadow-soft overflow-hidden card-hover flex flex-col h-full">
                    <div class="aspect-w-16 aspect-h-9 bg-gray-200">
                        <img src="${representativeProduct.image || categoryImage}" 
                              alt="${category}" 
                              class="w-full h-48 object-contain"
                              onerror="this.onerror=null; this.src='https://via.placeholder.com/300x200/6B7280/FFFFFF?text=Product+Image+Not+Found'; this.style.opacity='0.7';"
                              onload="this.style.opacity='1';">
                    </div>
                    <div class="p-4 flex flex-col flex-grow">
                        <h3 class="font-semibold text-gray-900 mb-3 text-center">${category}</h3>
                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-700">Price:</span>
                                <span class="text-sm font-bold text-blue-600">${ranges.priceRange}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-700">Length:</span>
                                <span class="text-sm text-gray-600">${ranges.lengthRange}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-700">Colors:</span>
                                <span class="text-sm text-gray-600">${ranges.colorRange}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-700">Styles:</span>
                                <span class="text-sm text-gray-600">${ranges.styleRange}</span>
                            </div>
                        </div>
                        <div class="mt-auto text-center">
                            <button onclick="viewCategoryDetails('${category}')" 
                                    class="text-white px-4 py-2 rounded text-sm transition-colors duration-200 w-full" 
                                    style="background-color: #081249;" 
                                    onmouseover="this.style.backgroundColor='#0a1a5c'" 
                                    onmouseout="this.style.backgroundColor='#081249'">
                                View Details
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
        
        document.getElementById('catalog-results-count').textContent = `${Object.keys(productsByCategory).length} categories found`;
        document.getElementById('catalog-results-count-display').textContent = `${Object.keys(productsByCategory).length} categories`;
    }
    
    // View category details function - shows all products in that category
    function viewCategoryDetails(category) {
        const categoryProducts = productData.filter(p => p.Category === category);
        showProductModal(categoryProducts, category);
    }

    // Show product modal with detailed information
    function showProductModal(products, categoryName) {
        const modal = document.getElementById('productModal');
        const modalContent = document.getElementById('modalProductList');
        
        modalContent.innerHTML = products.map(product => {
            // Get the appropriate image for the product
            const productImage = product.image || getCategoryImage(product.Category);
            
            return `
            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="md:w-1/2">
                         <img src="${productImage}" 
                              alt="${product.Product}" 
                              class="w-full h-96 object-contain rounded-lg bg-white shadow-lg"
                              style="max-height: 576px; min-height: 400px;"
                              onerror="this.onerror=null; this.src='https://via.placeholder.com/600x450/6B7280/FFFFFF?text=Product+Image+Not+Found'; this.style.opacity='0.7';"
                              onload="this.style.opacity='1';">
                     </div>
                    <div class="md:w-1/2">
                        <h3 class="text-xl font-bold text-gray-900 mb-3">${product.Product}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div class="flex justify-between items-center py-2 border-b border-gray-200">
                                <span class="font-medium text-gray-700">Category:</span>
                                <span class="text-gray-600">${product.Category}</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b border-gray-200">
                                <span class="font-medium text-gray-700">Price:</span>
                                <span class="text-lg font-bold text-blue-600">${SYMBOL[product.Currency] || ''}${product.Rate}</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b border-gray-200">
                                <span class="font-medium text-gray-700">Length:</span>
                                <span class="text-gray-600">${product.Length}"</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b border-gray-200">
                                <span class="font-medium text-gray-700">Colors:</span>
                                <span class="text-gray-600">${firebaseColors.length > 0 ? `${firebaseColors.length} colors available` : (product.Colors || 'N/A')}</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b border-gray-200">
                                <span class="font-medium text-gray-700">Styles:</span>
                                <span class="text-gray-600">${firebaseStyles.length > 0 ? `${firebaseStyles.length} styles available` : (product.Density || 'N/A')}</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b border-gray-200">
                                <span class="font-medium text-gray-700">Currency:</span>
                                <span class="text-gray-600">${product.Currency}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            `;
        }).join('');
        
        document.getElementById('modalCategoryTitle').textContent = categoryName;
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    // Close modal function
    function closeProductModal() {
        const modal = document.getElementById('productModal');
        modal.classList.add('hidden');
        document.body.style.overflow = 'auto';
    }
    
    // Initialize products on page load
    document.addEventListener('DOMContentLoaded', async function() {
        try {
            showLoading(true);
            
            // Initialize fallback system components (fallback-first strategy)
            try {
                console.log('ðŸ”„ Initializing fallback system with fallback-first strategy...');
                
                // Initialize local fallback manager
                if (typeof LocalFallbackManager !== 'undefined') {
                    window.localFallbackManager = new LocalFallbackManager();
                    await window.localFallbackManager.initialize();
                    console.log('âœ… Local fallback manager initialized');
                }
                
                // Initialize fallback detector
                if (typeof FallbackDetector !== 'undefined') {
                    window.fallbackDetector = new FallbackDetector();
                    await window.fallbackDetector.initialize();
                    console.log('âœ… Fallback detector initialized');
                }
                
                // Initialize unified data access with fallback-first priority
                if (typeof UnifiedDataAccess !== 'undefined') {
                    window.unifiedDataAccess = new UnifiedDataAccess();
                    await window.unifiedDataAccess.initialize();
                    console.log('âœ… Unified data access initialized (fallback-first)');
                }
                
                console.log('âœ… Fallback system fully initialized with fallback-first strategy');
            } catch (error) {
                console.warn('âš ï¸ Fallback system initialization failed:', error);
            }
            
            // Initialize Firebase as auxiliary data source
            try {
                if (window.universalDataManager) {
                    console.log('ðŸ”„ Initializing Firebase as auxiliary data source...');
                    await window.universalDataManager.waitForReady();
                    
                    const status = window.universalDataManager.getStatus();
                    if (status.isInitialized && status.isDataLoaded) {
                        console.log('âœ… Firebase auxiliary data source ready');
                    } else {
                        console.warn('âš ï¸ Firebase auxiliary data source not ready');
                    }
                }
            } catch (firebaseError) {
                console.warn('âš ï¸ Firebase auxiliary initialization failed:', firebaseError);
            }
            
            // Check API client availability
            if (window.apiClient && typeof window.apiClient.isAvailable === 'function') {
                console.log(`ðŸ”— API Client available: ${window.apiClient.isAvailable()}`);
            } else {
                console.warn('âš ï¸ API Client not properly loaded or missing isAvailable method');
            }
            
            // Load Firebase collections first
            await loadFirebaseCollections();
            
            // Load product data from Firebase
            await loadProductData();
            
            // Populate category dropdown after data is loaded
            populateCatalogCategories();
            
            // Render products after data is loaded
            renderProducts();
            
            console.log('Product catalog initialized successfully');
            
        } catch (error) {
            console.error('Error initializing product catalog:', error);
            // Show error message to user
            showErrorMessage('Failed to load product catalog. Please check your internet connection and try again.');
        } finally {
            showLoading(false);
        }
    });

    // Load product data using API client
    async function loadProductData() {
        try {
            console.log('ðŸ”„ Loading products via API client...');
            
            // Use the new API client for data access if available
            if (window.apiClient && typeof window.apiClient.isAvailable === 'function' && window.apiClient.isAvailable()) {
                productData = await window.apiClient.getProducts();
                console.log(`ðŸ“¦ Loaded ${productData.length} products from API client`);
                return;
            }
            
            // Fallback: If API client is not available, try the old methods
            console.warn('âš ï¸ API client not available or API endpoints not found, falling back to legacy methods...');
            
            // Try unified data access as fallback
            if (window.unifiedDataAccess) {
                try {
                    const products = await window.unifiedDataAccess.getData('products');
                    if (products && products.length > 0) {
                        productData = products;
                        console.log(`ðŸ“¦ Loaded ${products.length} products from unified data access (fallback)`);
                        return;
                    }
                } catch (unifiedError) {
                    console.warn('âš ï¸ Unified data access failed:', unifiedError);
                }
            }
            
            // Try local fallback manager as last resort
            if (window.localFallbackManager) {
                try {
                    const products = await window.localFallbackManager.getData('products');
                    if (products && products.length > 0) {
                        productData = products;
                        console.log(`ðŸ“¦ Loaded ${products.length} products from local fallback (last resort)`);
                        return;
                    }
                } catch (fallbackError) {
                    console.warn('âš ï¸ Local fallback failed:', fallbackError);
                }
            }
            
            // If all methods fail, set empty array
            console.warn('âš ï¸ No products data available from any source, using empty array');
            productData = [];
            
        } catch (error) {
            console.error('âŒ Error loading product data:', error);
            productData = [];
            throw error;
        }
    }

    // Populate category dropdown with unique categories from product data
    function populateCatalogCategories() {
        const categorySelect = document.getElementById('catalog-category');
        if (!categorySelect) return;
        
        // Get unique categories from product data
        const categories = [...new Set(productData.map(product => product.Category))].filter(Boolean).sort();
        
        // Clear existing options except "All Categories"
        categorySelect.innerHTML = '<option value="">All Categories</option>';
        
        // Add category options
        categories.forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            categorySelect.appendChild(option);
        });
        
        console.log(`ðŸ“‹ Populated ${categories.length} categories in dropdown`);
    }

    // Show/hide loading indicator
    function showLoading(show) {
        const loadingElement = document.getElementById('loading-indicator');
        if (loadingElement) {
            loadingElement.style.display = show ? 'flex' : 'none';
        }
    }

    // Show error message to user
    function showErrorMessage(message) {
        const catalogGrid = document.getElementById('catalog-grid');
        if (catalogGrid) {
            catalogGrid.innerHTML = `
                <div class="col-span-full flex flex-col items-center justify-center py-12 text-center">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-6 max-w-md">
                        <div class="flex items-center justify-center w-12 h-12 mx-auto mb-4 bg-red-100 rounded-full">
                            <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-red-800 mb-2">Connection Error</h3>
                        <p class="text-red-700 mb-4">${message}</p>
                        <button onclick="location.reload()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                            Try Again
                        </button>
                    </div>
                </div>
            `;
        }
    }
        
    // Apply catalog filters
    async function applyCatalogFilters() {
        const category = document.getElementById('catalog-category').value;
        const search = document.getElementById('catalog-search').value.toLowerCase();
        
        let filteredProducts = productData;
        
        // Filter by category
        if (category) {
            filteredProducts = filteredProducts.filter(product => product.Category === category);
        }
        
        // Filter by search term
        if (search) {
            filteredProducts = filteredProducts.filter(product => 
                product.Product.toLowerCase().includes(search) ||
                product.Category.toLowerCase().includes(search) ||
                (product.Colors && product.Colors.toLowerCase().includes(search))
            );
        }
        
        await renderProducts(filteredProducts);
    }
    
    function clearCatalogFilters() {
        document.getElementById('catalog-category').value = '';
        document.getElementById('catalog-search').value = '';
        renderProducts();
    }
    
    // Firebase Readiness Check
    function waitForFirebase() {
        return new Promise((resolve) => {
            if (window.globalFirebase && window.globalFirebase.isAvailable()) {
                resolve();
            } else {
                // Wait for global Firebase to be ready
                const checkInterval = setInterval(() => {
                    if (window.globalFirebase && window.globalFirebase.isAvailable()) {
                        clearInterval(checkInterval);
                        resolve();
                    }
                }, 100);
                
                // Fallback timeout
                setTimeout(() => {
                    clearInterval(checkInterval);
                    console.warn('âš ï¸ Global Firebase not ready, proceeding with local initialization');
                    resolve();
                }, 5000);
            }
        });
    }

    // Add event listeners for filters
    document.addEventListener('DOMContentLoaded', async function() {
        await waitForFirebase();
        console.log('âœ… Firebase ready for product catalog');
        // Category filter
        const categorySelect = document.getElementById('catalog-category');
        if (categorySelect) {
            categorySelect.addEventListener('change', applyCatalogFilters);
        }
        
        // Search filter
        const searchInput = document.getElementById('catalog-search');
        if (searchInput) {
            searchInput.addEventListener('input', applyCatalogFilters);
        }
        
        // Filter button
        const filterBtn = document.getElementById('catalog-filter-btn');
        if (filterBtn) {
            filterBtn.addEventListener('click', applyCatalogFilters);
        }
        
        // Clear button
        const clearBtn = document.getElementById('catalog-clear-btn');
        if (clearBtn) {
            clearBtn.addEventListener('click', clearCatalogFilters);
        }
    });
    </script>

    <!-- Product Details Modal -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b border-gray-200 p-6 flex justify-between items-center">
                <h2 id="modalCategoryTitle" class="text-2xl font-bold text-gray-900">Product Details</h2>
                <button onclick="closeProductModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="modalProductList" class="p-6">
                <!-- Product details will be populated here -->
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-indicator" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 flex flex-col items-center">
            <div class="loading"></div>
            <span class="text-gray-700 font-medium mt-4">Loading products...</span>
        </div>
    </div>
    
    <script>
        // Mobile menu functionality
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            
            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', function() {
                    mobileMenu.classList.toggle('hidden');
                });
            }
        });
    </script>
</body>
</html>